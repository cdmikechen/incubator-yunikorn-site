"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9852],{3905:function(e,t,a){a.d(t,{Zo:function(){return m},kt:function(){return c}});var n=a(7294);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,o=e.originalType,s=e.parentName,m=r(e,["components","mdxType","originalType","parentName"]),h=p(a),c=l,u=h["".concat(s,".").concat(c)]||h[c]||d[c]||o;return a?n.createElement(u,i(i({ref:t},m),{},{components:a})):n.createElement(u,i({ref:t},m))}));function c(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var o=a.length,i=new Array(o);i[0]=h;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:l,i[1]=r;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},1688:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return r},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return m},default:function(){return h}});var n=a(7462),l=a(3366),o=(a(7294),a(3905)),i=["components"],r={id:"gang_scheduling",title:"\u5e2e\u6d3e\u8c03\u5ea6\u8bbe\u8ba1"},s=void 0,p={unversionedId:"design/gang_scheduling",id:"design/gang_scheduling",title:"\u5e2e\u6d3e\u8c03\u5ea6\u8bbe\u8ba1",description:"\x3c!--",source:"@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/design/gang_scheduling.md",sourceDirName:"design",slug:"/design/gang_scheduling",permalink:"/incubator-yunikorn-site/zh-cn/docs/next/design/gang_scheduling",tags:[],version:"current",frontMatter:{id:"gang_scheduling",title:"\u5e2e\u6d3e\u8c03\u5ea6\u8bbe\u8ba1"},sidebar:"docs",previous:{title:"Scheduler Object States",permalink:"/incubator-yunikorn-site/zh-cn/docs/next/design/scheduler_object_states"},next:{title:"Evaluate YuniKorn Performance with Kubemark",permalink:"/incubator-yunikorn-site/zh-cn/docs/next/performance/evaluate_perf_function_with_kubemark"}},m=[{value:"\u6587\u6863\u76ee\u6807",id:"\u6587\u6863\u76ee\u6807",children:[],level:2},{value:"\u6392\u9664\u7684\u8bbe\u8ba1\u70b9",id:"\u6392\u9664\u7684\u8bbe\u8ba1\u70b9",children:[],level:2},{value:"\u901a\u7528\u6d41\u7a0b",id:"\u901a\u7528\u6d41\u7a0b",children:[],level:2},{value:"\u5e94\u7528\u63d0\u4ea4\u5904\u7406",id:"\u5e94\u7528\u63d0\u4ea4\u5904\u7406",children:[{value:"\u9884\u7559\u8d44\u6e90\u603b\u5927\u5c0f",id:"\u9884\u7559\u8d44\u6e90\u603b\u5927\u5c0f",children:[],level:3},{value:"\u4f7f\u7528 FAIR\uff08\u516c\u5e73\uff09\u6392\u5e8f\u7b56\u7565\u5904\u7406\u961f\u5217",id:"\u4f7f\u7528-fair\u516c\u5e73\u6392\u5e8f\u7b56\u7565\u5904\u7406\u961f\u5217",children:[],level:3}],level:2},{value:"\u5728\u8bbe\u7f6e\u4e86\u914d\u989d\u7684\u961f\u5217\u4e2d\u8fdb\u884c\u8c03\u5ea6",id:"\u5728\u8bbe\u7f6e\u4e86\u914d\u989d\u7684\u961f\u5217\u4e2d\u8fdb\u884c\u8c03\u5ea6",children:[],level:2},{value:"\u8c03\u5ea6\u5668\u903b\u8f91\u53d8\u5316",id:"\u8c03\u5ea6\u5668\u903b\u8f91\u53d8\u5316",children:[],level:2},{value:"\u5e94\u7528\u7a0b\u5e8f\u5b8c\u6210",id:"\u5e94\u7528\u7a0b\u5e8f\u5b8c\u6210",children:[{value:"\u5b9a\u4e49",id:"\u5b9a\u4e49",children:[],level:3},{value:"\u6e05\u7406",id:"\u6e05\u7406",children:[],level:3}],level:2},{value:"\u5e94\u7528\u6062\u590d",id:"\u5e94\u7528\u6062\u590d",children:[],level:2},{value:"\u63a5\u53e3\u53d8\u5316",id:"\u63a5\u53e3\u53d8\u5316",children:[{value:"AddApplication",id:"addapplication",children:[],level:3},{value:"AllocationAsk",id:"allocationask",children:[],level:3},{value:"Allocation",id:"allocation",children:[],level:3},{value:"AllocationRelease Response and Request",id:"allocationrelease-response-and-request",children:[],level:3},{value:"TerminationType",id:"terminationtype",children:[],level:3},{value:"AllocationAskRelease Response and Request",id:"allocationaskrelease-response-and-request",children:[],level:3}],level:2},{value:"Scheduler storage object changes",id:"scheduler-storage-object-changes",children:[{value:"AllocationAsk",id:"allocationask-1",children:[],level:3},{value:"Allocation",id:"allocation-1",children:[],level:3},{value:"Application",id:"application",children:[],level:3},{value:"Queue &amp; Node",id:"queue--node",children:[],level:3}],level:2}],d={toc:m};function h(e){var t=e.components,r=(0,l.Z)(e,i);return(0,o.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"\u5e2e\u6d3e\u8c03\u5ea6\u5b9e\u73b0"},"\u5e2e\u6d3e\u8c03\u5ea6\u5b9e\u73b0"),(0,o.kt)("p",null,"\u4e00\u79cd\u65b0\u7684\u8c03\u5ea6\u5e94\u7528\u7a0b\u5e8f\u7684\u65b9\u6cd5\uff0c\u5b83\u8003\u8651\u4e86\u5e94\u7528\u7a0b\u5e8f\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u9884\u8ba1\u4f1a\u4ea7\u751f\u7684\u8d44\u6e90\u9700\u6c42\u3002\n\u5b83\u901a\u8fc7\u9884\u7559\u8d44\u6e90\u6765\u4fdd\u8bc1\u5e94\u7528\u7a0b\u5e8f\u7684\u9884\u671f\u9700\u6c42\u8d44\u6e90\u3002"),(0,o.kt)("p",null,"\u8fd9\u4e2a\u5b9e\u73b0\u6709\u4e24\u4e2a\u90e8\u5206\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Kubernetes Shim"),(0,o.kt)("li",{parentName:"ul"},"Core\uff08\u4ee5\u540e\u6210\u4e3a\u6838\u5fc3\uff09\u548c scheduling (\u8c03\u5ea6)")),(0,o.kt)("p",null,"\u672c\u6587\u6863\u63cf\u8ff0\u4e86\u6838\u5fc3\u7aef\u7684\u5b9e\u73b0\u3002"),(0,o.kt)("h2",{id:"\u6587\u6863\u76ee\u6807"},"\u6587\u6863\u76ee\u6807"),(0,o.kt)("p",null,"\u672c\u6587\u6863\u63cf\u8ff0\u4e86\u4ee5\u4e0b\u5b9e\u73b0\u8bbe\u8ba1\u8981\u70b9\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5b9a\u4e49 shim \u5230\u6838\u5fc3\u901a\u4fe1\u6240\u9700\u7684\u8c03\u6574\uff08\u8c03\u5ea6\u5668\u63a5\u53e3\uff09"),(0,o.kt)("li",{parentName:"ol"},"\u8c03\u5ea6\u5668\u5b58\u50a8\u5bf9\u8c61\u53d8\u5316"),(0,o.kt)("li",{parentName:"ol"},"\u8c03\u5ea6\u5668\u903b\u8f91\u53d8\u5316")),(0,o.kt)("h2",{id:"\u6392\u9664\u7684\u8bbe\u8ba1\u70b9"},"\u6392\u9664\u7684\u8bbe\u8ba1\u70b9"),(0,o.kt)("p",null,"\u76ee\u524d\uff0c\u672c\u8bbe\u8ba1\u6587\u6863\u672a\u6db5\u76d6 Kubernetes shim \u7aef\u5b9e\u73b0\u3002"),(0,o.kt)("p",null,"\u672c\u8bbe\u8ba1\u5c06 ",(0,o.kt)("em",{parentName:"p"},"\u4e0d")," \u8ba8\u8bba\u6838\u5fc3\u7aef\u7684\u5e7f\u4e49\u62a2\u5360\u3002"),(0,o.kt)("h2",{id:"\u901a\u7528\u6d41\u7a0b"},"\u901a\u7528\u6d41\u7a0b"),(0,o.kt)("p",null,"\u8be5\u6d41\u7a0b\u7531\u5e94\u7528\u7a0b\u5e8f\u521b\u5efa\u7684 pod \u88ab\u63d0\u4ea4\u800c\u89e6\u53d1\u3002\n\u5728 Spark \u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u7b2c\u4e00\u4e2a Pod \u662f driver pod\u3002\n\u5982\u679c\u6d41\u7a0b\u662f\u4ece\u5e94\u7528\u7a0b\u5e8f CRD \u7684\u521b\u5efa\u89e6\u53d1\u7684\uff0c\u5219\u4e0d\u4f1a\u6709\u7b2c\u4e00\u4e2a pod\u3002\n\u7136\u800c\uff0c\u8fd9\u8d85\u51fa\u4e86\u6838\u5fc3\u8c03\u5ea6\u7684\u903b\u8f91\u3002\u4ece\u6838\u5fc3\u65b9\u9762\u6765\u770b\uff0c\u8fd9\u4e24\u79cd\u60c5\u51b5\u5e94\u8be5\u6ca1\u6709\u533a\u522b\u3002\n\u66f4\u591a\u7ec6\u8282\u5728 ",(0,o.kt)("a",{parentName:"p",href:"#%E8%B0%83%E5%BA%A6%E5%99%A8%E9%80%BB%E8%BE%91%E5%8F%98%E5%8C%96"},"\u8c03\u5ea6\u5668\u903b\u8f91\u53d8\u5316")," \u7ae0\u8282\u4e2d\u3002"),(0,o.kt)("p",null,"\u63d0\u4ea4\u7533\u8bf7\u7684\u6d41\u7a0b\u3002\u56fe\u4e2d\u7684\u6570\u5b57\u5bf9\u5e94\u4e8e\u56fe\u4e0b\u65b9\u7684\u63cf\u8ff0\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"\u901a\u7528\u6d41\u7a0b",src:a(4973).Z})),(0,o.kt)("p",null,"\u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u671f\u95f4shim\u548c\u6838\u5fc3\u7684\u7ec4\u5408\u6d41\u7a0b\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u63d0\u4ea4\u7684\u5e94\u7528\u7a0b\u5e8f\u5b9a\u4e49\u4e86\u4efb\u52a1\u7ec4\u3002 (1)"),(0,o.kt)("li",{parentName:"ul"},"shim \u521b\u5efa\u5e94\u7528\u7a0b\u5e8f\u5e76\u5c06\u5e94\u7528\u7a0b\u5e8f\u4f20\u9012\u7ed9\u6838\u5fc3\u3002 (2)"),(0,o.kt)("li",{parentName:"ul"},"shim \u4e3a\u4efb\u52a1\u7ec4\u7684\u6bcf\u4e2a\u6210\u5458\u521b\u5efa placeholder\uff08\u5360\u4f4d\uff09pod\u3002 (3)"),(0,o.kt)("li",{parentName:"ul"},"\u6309\u7167\u6b63\u5e38\u884c\u4e3a\uff0cpod \u4f5c\u4e3a\u5177\u6709\u6b63\u786e\u4fe1\u606f\u96c6\u7684\u5e94\u7528\u7a0b\u5e8f\u7684 AllocationAsk\uff08\u8d44\u6e90\u5206\u914d\u8bf7\u6c42\uff09\u88ab\u5904\u7406\u5e76\u4f20\u9012\u7ed9\u6838\u5fc3\u3002 (4)"),(0,o.kt)("li",{parentName:"ul"},"\u5360\u4f4d AllocationAsk \u7531\u6838\u5fc3\u8c03\u5ea6\uff0c\u5c31\u597d\u50cf\u5b83\u4eec\u662f\u6b63\u5e38\u7684 AllocationAsk \u4e00\u6837\u3002 (5)"),(0,o.kt)("li",{parentName:"ul"},"\u6240\u6709\u5206\u914d\uff0c\u5373\u4f7f\u5b83\u4eec\u662f\u7531\u8c03\u5ea6\u5668\u5206\u914d\u7684\u5360\u4f4d AllocationAsks \u7684\u7ed3\u679c\uff0c\u4e5f\u4f1a\u88ab\u4f20\u9001\u56de shim\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u539f\u59cb\u7684\u5b9e\u9645 pod \u4f5c\u4e3a AllocationAsk \u4f20\u9012\u7ed9\u6838\u5fc3\u3002 (6)"),(0,o.kt)("li",{parentName:"ul"},"\u5728\u5b9e\u9645 pod \u548c\u6240\u6709\u5360\u4f4d pod \u88ab\u8c03\u5ea6\u540e\uff0cshim \u542f\u52a8\u89e6\u53d1\u5e94\u7528\u7a0b\u5e8f\u521b\u5efa\u5b9e\u9645 pod\u3002 (7)")),(0,o.kt)("p",null,"\u5728\u7b2c\u4e00\u4e2a\u5b9e\u9645 pod \u542f\u52a8\u540e\uff0c\u4ee5\u4e0b pod \u90fd\u5e94\u8be5\u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u5904\u7406 (8)\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5728 k8s \u4e0a\u521b\u5efa\u4e86\u4e00\u4e2a\u5b9e\u9645 pod\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u5904\u7406 pod \u5e76\u521b\u5efa\u4e00\u4e2a AllocationAsk\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u8c03\u5ea6\u5668\u5904\u7406 AllocationAsk\uff08\u66f4\u591a\u7ec6\u8282\u89c1\u4e0b\u6587\uff09\u5e76\u7528\u5b9e\u9645\u5206\u914d\u66ff\u6362\u9884\u7559\u8d44\u6e90\u3002")),(0,o.kt)("h2",{id:"\u5e94\u7528\u63d0\u4ea4\u5904\u7406"},"\u5e94\u7528\u63d0\u4ea4\u5904\u7406"),(0,o.kt)("h3",{id:"\u9884\u7559\u8d44\u6e90\u603b\u5927\u5c0f"},"\u9884\u7559\u8d44\u6e90\u603b\u5927\u5c0f"),(0,o.kt)("p",null,"\u5982\u679c\u8bf7\u6c42\u4e00\u4e2a\u6216\u591a\u4e2a\u4efb\u52a1\u7ec4\uff0c\u5e94\u7528\u7a0b\u5e8f\u5e94\u8be5\u63d0\u4f9b\u5b83\u8981\u8bf7\u6c42\u7684\u6240\u6709\u4efb\u52a1\u7ec4\u6210\u5458\u7684\u603b\u5927\u5c0f\u3002\n\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u5728\u9650\u5236\u4e86\u8d44\u6e90\u7684\u961f\u5217\u4e2d\u88ab\u8c03\u5ea6\uff0c\u5219\u9700\u8981\u603b\u8d44\u6e90\u5927\u5c0f\u3002"),(0,o.kt)("p",null,"\u8be5\u503c\u5bf9\u4e8e\u4e09\u79cd\u60c5\u51b5\u5f88\u91cd\u8981\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5e2e\u6d3e\u8bf7\u6c42\u5927\u4e8e\u961f\u5217\u914d\u989d"),(0,o.kt)("li",{parentName:"ol"},"\u5f00\u59cb\u9884\u8c03\u5ea6"),(0,o.kt)("li",{parentName:"ol"},"\u9884\u8c03\u5ea6\u65f6\u7684\u8d44\u6e90\u538b\u529b")),(0,o.kt)("p",null,"\u8fdb\u4e00\u6b65\u7684\u7ec6\u8282\u5c06\u5728\u4e0b\u9762\u7684 ",(0,o.kt)("a",{parentName:"p",href:"#scheduling-in-queues-with-a-quota-set"},"\u5728\u8bbe\u7f6e\u4e86\u914d\u989d\u7684\u961f\u5217\u4e2d\u8fdb\u884c\u8c03\u5ea6")," \u4e2d\u7ed9\u51fa"),(0,o.kt)("p",null,"\u4ece shim \u4f20\u9012\u7684\u4fe1\u606f\u5e94\u8be5\u662f AddApplicationRequest \u4e2d\u7684\u4e00\u90e8\u5206\u3002\n\u4efb\u52a1\u7ec4\u7684\u5efa\u7acb\u6216\u6210\u5458\u6570\u91cf\u7684\u8be6\u7ec6\u4fe1\u606f\u4e0d\u76f8\u5173\u3002\n\u6240\u6709\u4efb\u52a1\u7ec4\u6210\u5458\u8bf7\u6c42\u7684\u603b\u8d44\u6e90\u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5\u8ba1\u7b97\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"\u8bf7\u6c42\u8ba1\u7b97",src:a(3553).Z})),(0,o.kt)("p",null,"placeholderAsk\uff08\u5360\u4f4d/\u8d44\u6e90\u9884\u7559\u8bf7\u6c42\uff09\u7684\u603b\u8ba1\u4fe1\u606f\u4f5c\u4e3a\u53ef\u9009\u5b57\u6bb5\u6dfb\u52a0\u5230 AddApplicationRequest \u6d88\u606f\u4e2d\u3002\n\u53ef\u4ee5\u7531 shim \u6839\u636e pod \u63cf\u8ff0\u4e2d\u63d0\u4f9b\u7684 CRD \u6216\u6ce8\u91ca\u8fdb\u884c\u8ba1\u7b97\u3002"),(0,o.kt)("p",null,"\u5982\u679c\u5360\u4f4d\u8bf7\u6c42\u5927\u4e8e\u961f\u5217\u4e0a\u8bbe\u7f6e\u7684\u961f\u5217\u914d\u989d\uff0c\u5219\u5fc5\u987b\u62d2\u7edd\u7533\u8bf7\u3002\n\u8fd9\u79cd\u62d2\u7edd\u662f\u57fa\u4e8e\u6211\u4eec\u4e0d\u80fd\u4ee5\u4efb\u4f55\u65b9\u5f0f\u6ee1\u8db3\u8bf7\u6c42\u7684\u4e8b\u5b9e\u3002\n\u5bf9\u4e8e\u6240\u6709\u5176\u4ed6\u60c5\u51b5\uff0c\u4f1a\u63a5\u53d7\u7533\u8bf7\u5e76\u8fdb\u884c\u6b63\u5e38\u7684\u5b89\u6392\u3002"),(0,o.kt)("h3",{id:"\u4f7f\u7528-fair\u516c\u5e73\u6392\u5e8f\u7b56\u7565\u5904\u7406\u961f\u5217"},"\u4f7f\u7528 FAIR\uff08\u516c\u5e73\uff09\u6392\u5e8f\u7b56\u7565\u5904\u7406\u961f\u5217"),(0,o.kt)("p",null,"\u5982\u679c\u5c06\u5e94\u7528\u7a0b\u5e8f\u63d0\u4ea4\u5230\u8bbe\u7f6e\u4e86 FAIR \u6392\u5e8f\u7b56\u7565\u7684\u961f\u5217\uff0c\u5219\u5fc5\u987b\u62d2\u7edd\u8be5\u5e94\u7528\u7a0b\u5e8f\u3002\n\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u6240\u5728\u961f\u5217\u7684\u961f\u5217\u6392\u5e8f\u5fc5\u987b\u8bbe\u7f6e\u4e3a ",(0,o.kt)("em",{parentName:"p"},"FIFO")," \u6216 ",(0,o.kt)("em",{parentName:"p"},"StateAware"),"\u3002"),(0,o.kt)("p",null,"\u5176\u4ed6\u961f\u5217\u7b56\u7565\u4e0d\u80fd\u4fdd\u8bc1\u4e00\u6b21\u53ea\u5904\u7406\u4e00\u4e2a ",(0,o.kt)("em",{parentName:"p"},"\u65b0\u7684")," \u5e94\u7528\u7a0b\u5e8f\u3002\n\u5728 ",(0,o.kt)("em",{parentName:"p"},"\u516c\u5e73")," \u7b56\u7565\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u540c\u65f6\u5206\u914d\u591a\u4e2a ",(0,o.kt)("em",{parentName:"p"},"\u65b0\u7684")," \u5e94\u7528\u7a0b\u5e8f\uff0c\u4ece\u800c\u65e0\u6cd5\u5f3a\u5236\u5b9e\u65bd\u914d\u989d\u7ba1\u7406\u3002\n\u4f7f\u7528 ",(0,o.kt)("em",{parentName:"p"},"\u516c\u5e73")," \u7b56\u7565\u7684\u53e6\u4e00\u4e2a\u526f\u4f5c\u7528\u53ef\u80fd\u662f\u6211\u4eec\u5f97\u5230\u591a\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4f46\u53ea\u6709\u90e8\u5206\u80fd\u4fdd\u8bc1\u5206\u914d\u3002"),(0,o.kt)("p",null,"\u7531\u4e8e\u6838\u5fc3\u65e0\u6cd5\u5c06\u5360\u4f4d\u60c5\u51b5\u653e\u7f6e\u5728\u4efb\u4f55\u8282\u70b9\u4e0a\uff0c\u56e0\u6b64\u53ef\u4ee5\u89e6\u53d1\u81ea\u52a8\u7f29\u653e\u3002\n\u5982\u679c\u961f\u5217\u4f7f\u7528 ",(0,o.kt)("em",{parentName:"p"},"\u516c\u5e73")," \u6392\u5e8f\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u653e\u5927\u7684\u8282\u70b9\u800c\u4e0d\u662f\u9884\u7559\u8d44\u6e90\u4ece\u800c\u518d\u6b21\u7834\u574f\u5e2e\u6d3e\u8c03\u5ea6\u3002"),(0,o.kt)("h2",{id:"\u5728\u8bbe\u7f6e\u4e86\u914d\u989d\u7684\u961f\u5217\u4e2d\u8fdb\u884c\u8c03\u5ea6"},"\u5728\u8bbe\u7f6e\u4e86\u914d\u989d\u7684\u961f\u5217\u4e2d\u8fdb\u884c\u8c03\u5ea6"),(0,o.kt)("p",null,"\u4e0a\u9762\u5df2\u7ecf\u63cf\u8ff0\u7684\u4e3b\u8981\u60c5\u51b5\u662f\u5904\u7406\u5927\u4e8e\u961f\u5217\u4e0a\u8bbe\u7f6e\u7684\u914d\u989d\u7684\u603b\u5360\u4f4d\u8bf7\u6c42\u5927\u5c0f\u3002\n\u63d0\u4ea4\u7533\u8bf7\u65f6\uff0c\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u8bc4\u4f30\u6211\u4eec\u65e0\u6cd5\u6ee1\u8db3\u8be5\u8981\u6c42\u5e76\u62d2\u7edd\u8be5\u8bf7\u6c42\u3002"),(0,o.kt)("p",null,"\u5728\u603b\u5360\u4f4d\u8bf7\u6c42\u786e\u5b9e\u9002\u5408\u961f\u5217\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4e0d\u5e94\u8be5\u5f00\u59cb\u8c03\u5ea6\uff0c\u76f4\u5230\u961f\u5217\u4e2d\u6709\u8db3\u591f\u7684\u53ef\u7528\u8d44\u6e90\u6765\u6ee1\u8db3\u603b\u8bf7\u6c42\u3002\n\u7136\u800c\uff0c\u8fd9\u4e0d\u4f1a\u505c\u6b62\u5bf9\u961f\u5217\u4e2d\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u7684\u8c03\u5ea6\u3002\n\u5df2\u5728\u961f\u5217\u4e2d\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u8bf7\u6c42\u66f4\u591a\u8d44\u6e90\u3002\n\u4ece\u5e94\u7528\u7a0b\u5e8f\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5b83\u53ef\u4ee5\u8bf7\u6c42\u7684\u8d44\u6e90\u6ca1\u6709\u9650\u5236\u3002\n\u5e94\u7528\u7a0b\u5e8f\u4e0a\u5b9a\u4e49\u7684\u8054\u90a6\u662f\u6709\u4fdd\u8bc1\u7684\u8d44\u6e90\u6570\u91cf\uff0c\u800c\u4e0d\u662f\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u8bf7\u6c42\u7684\u6700\u5927\u8d44\u6e90\u6570\u91cf\u3002"),(0,o.kt)("p",null,"\u6211\u4eec\u62e5\u6709\u7684\u961f\u5217\u5c42\u6b21\u7ed3\u6784\u662f\u5f88\u590d\u6742\u7684\u3002\n\u914d\u989d\u53ef\u80fd\u4e0d\u662f\u76f4\u63a5\u5728\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u7684\u961f\u5217\u4e0a\u8bbe\u7f6e\u7684\u3002\n\u5b83\u53ef\u4ee5\u8bbe\u7f6e\u5728\u67d0\u4e00\u4e2a\u7236\u961f\u5217\u4e0a\u9762\u3002\n\u8fd9\u79cd\u60c5\u51b5\u53ef\u80fd\u4f1a\u53d8\u5f97\u590d\u6742\uff0c\u6211\u4eec\u9700\u8981\u4fdd\u8bc1\u8bb0\u4f4f\u6211\u4eec\u53ef\u4ee5\u5b9e\u65f6\u9501\u5b9a\u8c03\u5ea6\u3002"),(0,o.kt)("p",null,"\u5728\u7b2c\u4e00\u9636\u6bb5\u4e2d\uff0c\u6211\u4eec\u5e94\u8be5\u5173\u6ce8\u8fd9\u6837\u4e00\u79cd\u60c5\u51b5\uff0c\u5373\u8bf7\u6c42\u7684\u8054\u90a6\u8d44\u6e90\u4e5f\u662f\u5e94\u7528\u7a0b\u5e8f\u5c06\u8bf7\u6c42\u7684\u6700\u5927\u8d44\u6e90\u6570\u3002\n\u5f53\u6211\u4eec\u67e5\u770b\u961f\u5217\u65f6\uff0c\u6211\u4eec\u5e94\u8be5\u5173\u6ce8\u5177\u6709\u914d\u989d\u7684\u5355\u4e2a\u961f\u5217\u7ea7\u522b\u3002"),(0,o.kt)("p",null,"\u8fd9\u4e24\u4e2a\u5047\u8bbe\u5bf9\u4e8e\u6ca1\u6709\u4f7f\u7528\u4ece\u547d\u540d\u7a7a\u95f4\u5230\u961f\u5217\u7684\u52a8\u6001\u6620\u5c04\u8fdb\u884c\u52a8\u6001\u5206\u914d\u7684 spark \u7528\u4f8b\u662f\u6b63\u786e\u7684\u3002"),(0,o.kt)("p",null,"\u6b64\u5916\uff0c\u6211\u4eec\u5047\u8bbe\u961f\u5217\u4e0a\u8bbe\u7f6e\u7684\u914d\u989d\u53ef\u4ee5\u5b8c\u5168\u5206\u914d\u3002\n\u5982\u679c\u96c6\u7fa4\u6ca1\u6709\u8db3\u591f\u7684\u8d44\u6e90\uff0c\u96c6\u7fa4\u5c06\u6269\u5c55\uff0c\u76f4\u5230\u4e3a\u6240\u6709\u961f\u5217\u63d0\u4f9b\u5168\u90e8\u914d\u989d\u6240\u9700\u7684\u5927\u5c0f\u3002"),(0,o.kt)("p",null,"\u8fd9\u4e5f\u53ef\u4ee5\u5728\u67d0\u4e9b\u7528\u4f8b\u4e2d\u5229\u7528\u62a2\u5360\uff0c\u4f8b\u5982\u62a2\u5360\u5e94\u7528\u7a0b\u5e8f\u8d85\u8fc7\u5176\u603b\u7684\u8054\u90a6\u5927\u5c0f\u7684\u5206\u914d\u3002\n\u5728\u67d0\u4e9b\u7528\u4f8b\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5229\u7528\u62a2\u5360\uff0c\u6bd4\u5982\u5728\u5e94\u7528\u7a0b\u5e8f\u7684\u603b\u5e2e\u6d3e\u89c4\u6a21\u4e0a\u62a2\u5360\u5206\u914d\u3002"),(0,o.kt)("p",null,"\u901a\u8fc7\u5141\u8bb8\u6307\u5b9a\u65f6\u95f4\u548c\u5e94\u7528\u7a0b\u5e8f\u6765\u7b49\u5f85\u5360\u4f4d\u5206\u914d\uff0c\u6216\u5f00\u59cb\u4f7f\u7528\u4fdd\u7559\u8d44\u6e90\u7684\u65f6\u95f4\uff0c\u53ef\u4ee5\u6dfb\u52a0\u8fdb\u4e00\u6b65\u7684\u589e\u5f3a\u529f\u80fd\u3002"),(0,o.kt)("h2",{id:"\u8c03\u5ea6\u5668\u903b\u8f91\u53d8\u5316"},"\u8c03\u5ea6\u5668\u903b\u8f91\u53d8\u5316"),(0,o.kt)("p",null,"\u8c03\u5ea6\u5668\u903b\u8f91\u7684\u53d8\u5316\u9700\u8981\u8003\u8651\u5468\u671f\u7684\u4e24\u4e2a\u90e8\u5206\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5360\u4f4d\u8bf7\u6c42\u53ca\u5176\u5206\u914d\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u66ff\u6362\u5360\u4f4d\u7684\u5206\u914d\u3002")),(0,o.kt)("p",null,"\u6211\u4eec\u7684\u57fa\u672c\u5047\u8bbe\u662f\u6240\u6709 pod \u90fd\u4f1a\u5411\u6838\u5fc3\u751f\u6210\u5360\u4f4d pod \u8bf7\u6c42\u3002\n\u5982\u679c\u6211\u4eec\u4e0d\u4f7f\u7528\u5e94\u7528\u7a0b\u5e8f CRD\uff0c\u8fd9\u5305\u62ec\u89e6\u53d1\u5e94\u7528\u7a0b\u5e8f\u521b\u5efa\u7684 pod\u3002\n\u8fd9\u4e2a\u5047\u8bbe\u662f\u5fc5\u987b\u7684\uff0c\u624d\u80fd\u786e\u4fdd\u8c03\u5ea6\u5668\u6838\u5fc3\u53ef\u4ee5\u5728\u63d0\u4ea4\u5e94\u7528\u7a0b\u5e8f\u7684\u4e24\u79cd\u65b9\u5f0f\u4e2d\u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u8fd0\u884c\u3002\n\u5360\u4f4d Pod \u5fc5\u987b\u5728\u771f\u6b63\u7684 Pod \u4e4b\u524d\u4e0e\u6838\u5fc3\u901a\u4fe1\u3002"),(0,o.kt)("p",null,"\u66f4\u6539\u5360\u4f4d AllocationAsks \u662f\u7b2c\u4e00\u6b65\u3002\n\u4f5c\u4e3a\u5e94\u7528\u7a0b\u5e8f\u521b\u5efa\u7684\u4e00\u90e8\u5206\uff0cAllocationAsks \u88ab\u6dfb\u52a0\u3002\n\u6dfb\u52a0 AllocationsAsk \u901a\u5e38\u4f1a\u6839\u636e\u8c03\u5ea6\u5468\u671f\u89e6\u53d1\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u7684\u66f4\u6539\u3002\n\u5b83\u5c06\u5e94\u7528\u7a0b\u5e8f\u4ece ",(0,o.kt)("em",{parentName:"p"},"New")," \u72b6\u6001\u79fb\u52a8\u5230 ",(0,o.kt)("em",{parentName:"p"},"Accepted")," \u72b6\u6001\u3002\u8fd9\u4e0e\u5f53\u524d\u8bbe\u7f6e\u4e00\u81f4\uff0c\u5e76\u4e14\u4e0d\u4f1a\u66f4\u6539\u3002"),(0,o.kt)("p",null,"\u4f46\u662f\uff0c\u5728 AllocationAsk \u8bbe\u7f6e\u4e86 ",(0,o.kt)("em",{parentName:"p"},"placeholder")," \u6807\u5fd7\u7684\u60c5\u51b5\u4e0b\uff0c\u5206\u914d\u4e0d\u5e94\u89e6\u53d1\u72b6\u6001\u66f4\u6539\uff0c\u5e94\u7528\u7a0b\u5e8f\u4fdd\u6301\u5728 ",(0,o.kt)("em",{parentName:"p"},"Accepted")," \u72b6\u6001\u3002\n\u5904\u7406\u5206\u914d\u8bf7\u6c42\uff0c\u76f4\u5230\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709 pending \uff08\u6302\u8d77\uff09\u7684\u8d44\u6e90\u3002\n\u4f5c\u4e3a\u5b89\u5168\u9884\u9632\u63aa\u65bd\uff0c\u5e94\u5ffd\u7565\u672a\u8bbe\u7f6e ",(0,o.kt)("em",{parentName:"p"},"placeholder")," \u6807\u5fd7\u7684 AllocationAsk\u3002\n\u5360\u4f4d Pod \u7684\u6240\u6709\u7ed3\u679c\u5206\u914d\u90fd\u6309\u7167\u6b63\u5e38\u6b65\u9aa4\u5411 shim \u786e\u8ba4\u3002\n\u8fd9\u4e2a\u8fc7\u7a0b\u4e00\u76f4\u6301\u7eed\u5230\u6ca1\u6709\u66f4\u591a\u7684\u5360\u4f4d pod \u88ab\u5206\u914d\u3002"),(0,o.kt)("p",null,"\u6b64\u65f6\u7684 shim \u5e94\u4e3a\u5df2\u7f13\u51b2\u7684\u771f\u5b9e pod \u521b\u5efa\u5206\u914d\u4efb\u52a1\u3002\n\u6838\u5fc3\u4e0d\u80fd\u4e5f\u4e0d\u9700\u5047\u8bbe\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u53ea\u6709\u4e00\u4e2a\u4efb\u52a1\u7ec4\u3002\n\u5982\u679c shim \u4f7f\u7528\u4e86\u4e0a\u8ff0\u9009\u98791\uff0c\u5219\u6838\u5fc3\u4e5f\u65e0\u6cd5\u5047\u8bbe\u5b83\u5df2\u6536\u5230\u5c5e\u4e8e\u4efb\u52a1\u7ec4\u7684\u6240\u6709\u5206\u914d\u4efb\u52a1\u3002\n\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u6211\u4eec\u5047\u8bbe\u6bcf\u4e2a pod \u90fd\u4f1a\u5411\u6838\u5fc3\u521b\u5efa\u4e00\u4e2a\u5360\u4f4d\u8bf7\u6c42\u3002"),(0,o.kt)("p",null,"\u7b2c\u4e8c\u4e2a\u53d8\u5316\u662f\u7528\u771f\u6b63\u7684 pod \u66ff\u6362\u4e86\u5360\u4f4d pod\u3002\n\u586b\u5145\u7a0b\u5e8f\u521b\u5efa\u4e86\u4e00\u4e2a\u8bbe\u7f6e\u4e86 ",(0,o.kt)("em",{parentName:"p"},"\u4efb\u52a1\u7ec4\u540d\u79f0")," \u4f46\u672a\u8bbe\u7f6e ",(0,o.kt)("em",{parentName:"p"},"placeholder")," \u6807\u5fd7\u7684 AllocationAsk\u3002"),(0,o.kt)("p",null,"\u8fd9\u91cc\u63cf\u8ff0\u7684\u8fc7\u7a0b\u4e0e\u901a\u7528\u62a2\u5360\u7684\u8fc7\u7a0b\u4e00\u81f4\u3002\n\u5206\u914d\u7531\u6838\u5fc3\u91ca\u653e\uff0c\u7136\u540e\u7531 shim \u786e\u8ba4\u3002\n\u5bf9\u4e8e\u5e2e\u6d3e\u8c03\u5ea6\uff0c\u6211\u4eec\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u4e00\u5bf9\u4e00\u91ca\u653e\u5173\u7cfb\uff0c\u5728\u62a2\u5360\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5177\u6709\u4e00\u5bf9\u591a\u91ca\u653e\u5173\u7cfb\u7684\u76f8\u540c\u6d41\u7a0b\u3002"),(0,o.kt)("p",null,"\u8c03\u5ea6\u5668\u6309\u5982\u4e0b\u65b9\u5f0f\u5904\u7406 AllocationAsk\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u68c0\u67e5\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u6709\u672a\u91ca\u653e\u7684\u5206\u914d\u7ed9\u5177\u6709\u76f8\u540c ",(0,o.kt)("em",{parentName:"li"},"\u4efb\u52a1\u7ec4\u540d\u79f0")," \u7684\u5360\u4f4d\u5206\u914d\u3002\u5982\u679c\u6ca1\u6709\u627e\u5230\u5360\u4f4d\u5206\u914d\uff0c\u5c06\u4f7f\u7528\u6b63\u5e38\u7684\u5206\u914d\u5468\u671f\u6765\u5206\u914d\u8bf7\u6c42\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u4e00\u4e2a\u5360\u4f4d\u5206\u914d\u88ab\u9009\u62e9\u5e76\u6807\u8bb0\u4e3a\u91ca\u653e\u3002\u91ca\u653e\u5360\u4f4d\u5206\u914d\u7684\u8bf7\u6c42\u88ab\u4f20\u9001\u5230 shim\u3002\u8fd9\u5fc5\u987b\u662f\u4e00\u4e2a\u5f02\u6b65\u8fc7\u7a0b\uff0c\u56e0\u4e3a shim \u91ca\u653e\u8fc7\u7a0b\u53d6\u51b3\u4e8e\u5e95\u5c42\u7684 K8s \u54cd\u5e94\uff0c\u8fd9\u53ef\u80fd\u4e0d\u662f\u5373\u65f6\u7684\u3002\n\u6ce8\u610f\uff1a\u6b64\u65f6\u6838\u5fc3\u4e2d\u6ca1\u6709\u91ca\u653e\u4efb\u4f55\u5206\u914d\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u6838\u5fc3\u201c\u6682\u505c\u201d\u5904\u7406\u771f\u6b63\u7684 AllocationAsk\uff0c\u76f4\u5230 shim \u54cd\u5e94\u786e\u8ba4\u5df2\u91ca\u653e\u5360\u4f4d\u5206\u914d\u3002\n\u6ce8\u610f\uff1a\u91ca\u653e\u9501\u4ee5\u5141\u8bb8\u8c03\u5ea6\u7ee7\u7eed"),(0,o.kt)("li",{parentName:"ol"},"\u5728\u6536\u5230\u6765\u81ea shim \u7684\u91ca\u653e\u786e\u8ba4\u540e\uff0c\u201c\u6682\u505c\u7684\u201d AllocationAsk \u5904\u7406\u4f1a\u7ed3\u675f\u3002"),(0,o.kt)("li",{parentName:"ol"},"AllocationAsk \u5206\u914d\u5728\u4e0e\u4f7f\u7528\u7684\u5360\u4f4d\u76f8\u540c\u7684\u8282\u70b9\u4e0a\u3002\n\u5728\u4efb\u4f55\u4e00\u79cd\u60c5\u51b5\u4e0b\uff0c\u5360\u4f4d\u5206\u914d\u7684\u5220\u9664\u90fd\u5c06\u5b8c\u6210\u3002\u8fd9\u4e00\u5207\u90fd\u9700\u8981\u4f5c\u4e3a\u5bf9\u5e94\u7528\u7a0b\u5e8f\u3001\u961f\u5217\u548c\u8282\u70b9\u7684\u4e00\u6b21\u66f4\u65b0\u6765\u5b9e\u73b0\u3002",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"\u6210\u529f\u65f6\uff1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5206\u914d\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u5931\u8d25\u65f6\uff1a\u5c1d\u8bd5\u5728\u4e0d\u540c\u7684\u8282\u70b9\u4e0a\u5206\u914d\uff0c\u5982\u679c\u5931\u8d25\uff0cAllocationAsk \u53d8\u5f97\u4e0d\u53ef\u8c03\u5ea6\uff0c\u5e76\u89e6\u53d1\u6269\u5c55\u3002"))),(0,o.kt)("li",{parentName:"ol"},"\u5c06\u5206\u914d\u4f20\u8fbe\u56deshim\uff08\u5982\u679c\u9002\u7528\uff0c\u57fa\u4e8e\u6b65\u9aa4 5\uff09")),(0,o.kt)("h2",{id:"\u5e94\u7528\u7a0b\u5e8f\u5b8c\u6210"},"\u5e94\u7528\u7a0b\u5e8f\u5b8c\u6210"),(0,o.kt)("p",null,"\u5e94\u7528\u7a0b\u5e8f\u5b8c\u6210\u4e00\u76f4\u662f\u4e00\u4e2a\u957f\u671f\u5b58\u5728\u7684\u95ee\u9898\u3002\n\u76ee\u524d\uff0c\u5e94\u7528\u7a0b\u5e8f\u5728\u5b8c\u6210\u65f6\u4e0d\u4f1a\u8f6c\u6362\u5230 ",(0,o.kt)("em",{parentName:"p"},"completed")," \u72b6\u6001\u3002\n\u5e94\u7528\u7a0b\u5e8f\u7684\u5f53\u524d\u72b6\u6001\u662f ",(0,o.kt)("a",{parentName:"p",href:"/incubator-yunikorn-site/zh-cn/docs/next/design/scheduler_object_states"},"\u53c2\u8003\u6587\u6863"),"\u3002\n\u4f46\u662f\uff0c\u6b64\u65f6\u5e94\u7528\u7a0b\u5e8f\u5c06\u4e0d\u4f1a\u8fbe\u5230 ",(0,o.kt)("em",{parentName:"p"},"completed")," \u72b6\u6001\uff0c\u800c\u662f\u505c\u7559\u5728 ",(0,o.kt)("em",{parentName:"p"},"waiting")," \u72b6\u6001\u3002"),(0,o.kt)("p",null,"\u8fd9\u63d0\u4f9b\u4e86\u8bb8\u591a\u95ee\u9898\uff0c\u7279\u522b\u662f\u5728\u957f\u65f6\u95f4\u8fd0\u884c\u90e8\u7f72\u4e2d\u7684\u5185\u5b58\u4f7f\u7528\u548c\u961f\u5217\u6e05\u7406\u7684\u60c5\u51b5\u4e0b\u3002"),(0,o.kt)("h3",{id:"\u5b9a\u4e49"},"\u5b9a\u4e49"),(0,o.kt)("p",null,"\u7531\u4e8e\u6211\u4eec\u4e0d\u80fd\u4f9d\u8d56\u5728 Kubernetes \u4e0a\u4f5c\u4e3a Pod \u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u6765\u8868\u660e\u5b83\u5df2\u7ecf\u5b8c\u6210\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5b9a\u4e49\u4f55\u65f6\u8003\u8651\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684 ",(0,o.kt)("em",{parentName:"p"},"\u5b8c\u6210")," \u3002\n\u5728\u8fd9\u4e00\u70b9\u4e0a\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5728\u5b9a\u4e49\u7684\u65f6\u95f4\u6bb5\u5185\u5904\u4e8e ",(0,o.kt)("em",{parentName:"p"},"\u7b49\u5f85")," \u72b6\u6001\u65f6\uff0c\u5b83\u4f1a\u53d8\u6210 ",(0,o.kt)("em",{parentName:"p"},"\u5b8c\u6210")," \u3002\n\u5f53\u6ca1\u6709\u6d3b\u52a8\u5206\u914d\uff08\u5df2\u5206\u914d\u8d44\u6e90 > 0\uff09\u548c\u6302\u8d77\u5206\u914d\u8bf7\u6c42\uff08\u6302\u8d77\u8d44\u6e90 > 0\uff09\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u3002"),(0,o.kt)("p",null,"\u5411 ",(0,o.kt)("em",{parentName:"p"},"waiting")," \u72b6\u6001\u7684\u8f6c\u6362\u5df2\u7ecf\u5b9e\u73b0\u3002\n",(0,o.kt)("em",{parentName:"p"},"waiting")," \u72b6\u6001\u7684\u8d85\u65f6\u662f\u4e00\u9879\u65b0\u7684\u529f\u80fd\u3002"),(0,o.kt)("p",null,"\u8d44\u6e90\u9884\u7559\u4e0d\u88ab\u89c6\u4e3a\u6d3b\u52a8\u5206\u914d\u3002\n\u5360\u4f4d\u8bf7\u6c42\u88ab\u89c6\u4e3a\u5f85\u5904\u7406\u7684\u8d44\u6e90\u8bf7\u6c42\u3002\n\u8fd9\u4e9b\u60c5\u51b5\u5c06\u5728\u4e0b\u9762\u7684 ",(0,o.kt)("a",{parentName:"p",href:"#Cleanup"},"\u6e05\u7406")," \u4e2d\u5904\u7406\u3002"),(0,o.kt)("h3",{id:"\u6e05\u7406"},"\u6e05\u7406"),(0,o.kt)("p",null,"\u5f53\u6211\u4eec\u67e5\u770b\u5e2e\u6d3e\u8c03\u5ea6\u65f6\uff0c\u8fd8\u6709\u4e00\u4e2a\u5173\u4e8e\u672a\u4f7f\u7528\u7684\u9884\u7559\u8d44\u6e90\u3001\u5360\u4f4d\u8bf7\u6c42\u53ca\u5176\u6e05\u7406\u7684\u95ee\u9898\u3002\n\u9884\u7559\u8d44\u6e90\u53ef\u4ee5\u5728\u6709\u5f85\u5904\u7406\u5206\u914d\u8bf7\u6c42\u6216\u6d3b\u52a8\u5206\u914d\u7684\u4efb\u4f55\u65f6\u5019\u8f6c\u6362\u4e3a\u5b9e\u9645\u5206\u914d\u3002"),(0,o.kt)("p",null,"\u5728\u5904\u7406\u5b9e\u9645\u5206\u914d\u4e4b\u524d\uff0c\u5360\u4f4d\u8bf7\u6c42\u5c06\u5168\u90e8\u8f6c\u6362\u4e3a\u5360\u4f4d\u5206\u914d\u3002"),(0,o.kt)("p",null,"\u8fdb\u5165 ",(0,o.kt)("em",{parentName:"p"},"waiting")," \u72b6\u6001\u5df2\u88ab\u5904\u7406\u3002\n\u5982\u679c\u5c06\u65b0\u7684\u5206\u914d\u8bf7\u6c42\u6dfb\u52a0\u5230\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u5b83\u5c06\u8f6c\u6362\u56de ",(0,o.kt)("em",{parentName:"p"},"running")," \u72b6\u6001\u3002\n\u5f53\u6211\u4eec\u8fdb\u5165\u4e86\u7b49\u5f85\u72b6\u6001\uff0c\u5c06\u6ca1\u6709\u5f85\u5904\u7406\u7684\u8bf7\u6c42\u6216\u5206\u914d\u7684\u8d44\u6e90\u3002\n\u53ea\u6709\u53ef\u4ee5\u5206\u914d\u7684\u9884\u7559\u8d44\u6e90\u3002"),(0,o.kt)("p",null,"\u4e3a\u4e86\u8fdb\u5165 ",(0,o.kt)("em",{parentName:"p"},"waiting")," \u72b6\u6001\uff0c\u5e94\u7528\u7a0b\u5e8f\u5fc5\u987b\u662f\u5e72\u51c0\u7684\u3002\n\u4f46\u662f\uff0c\u6211\u4eec\u4e0d\u80fd\u4fdd\u8bc1\u5728\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u671f\u95f4\u5e94\u7528\u7a0b\u5e8f\u5c06\u4f7f\u7528\u6240\u6709\u9884\u7559\u8d44\u6e90\u3002\n\u4ece ",(0,o.kt)("em",{parentName:"p"},"waiting")," \u72b6\u6001\u8f6c\u6362\u5230 ",(0,o.kt)("em",{parentName:"p"},"completed")," \u72b6\u6001\u6839\u672c\u4e0d\u9700\u8981\uff08\u5360\u4f4d\uff09\u5206\u914d\u6216\u8bf7\u6c42\u3002\n\u5f71\u54cd\u8f6c\u6362\u7684\u7b2c\u4e8c\u79cd\u60c5\u51b5\u662f\u5e76\u975e\u6240\u6709\u5360\u4f4d\u8bf7\u6c42\u90fd\u88ab\u5206\u914d\uff0c\u56e0\u6b64\u5e94\u7528\u7a0b\u5e8f\u4ece\u4e0d\u8bf7\u6c42\u4efb\u4f55\u771f\u6b63\u7684\u5206\u914d\u3002\n\u8fd9\u4e24\u79cd\u60c5\u51b5\u53ef\u80fd\u4f1a\u963b\u6b62\u5e94\u7528\u7a0b\u5e8f\u8f6c\u6362\u51fa ",(0,o.kt)("em",{parentName:"p"},"accepted")," \u6216 ",(0,o.kt)("em",{parentName:"p"},"waiting")," \u72b6\u6001\u3002"),(0,o.kt)("p",null,"\u56e0\u6b64\uff0c\u6838\u5fc3\u4e2d\u7684\u5904\u7406\u9700\u8981\u8003\u8651\u4e24\u79cd\u4f1a\u5f71\u54cd\u7279\u5b9a\u72b6\u6001\u7684\u8f6c\u6362\u7684\u60c5\u51b5\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5360\u4f4d\u8bf7\u6c42\u6302\u8d77\uff08\u9000\u51fa ",(0,o.kt)("em",{parentName:"li"},"accepted")," \uff09"),(0,o.kt)("li",{parentName:"ol"},"\u5360\u4f4d\u5206\u914d\uff08\u9000\u51fa ",(0,o.kt)("em",{parentName:"li"},"waiting")," \uff09")),(0,o.kt)("p",null,"\u5360\u4f4d\u8bf7\u6c42\u6302\u8d77\uff1a\n\u6302\u8d77\u7684\u5360\u4f4d\u7b26\u662f\u901a\u8fc7\u8d85\u65f6\u6765\u5904\u7406\u7684\u3002\n\u5e94\u7528\u7a0b\u5e8f\u53ea\u80fd\u82b1\u8d39\u6709\u9650\u7684\u65f6\u95f4\u7b49\u5f85\u5206\u914d\u6240\u6709\u9884\u7559\u8d44\u6e90\u3002\n\u8fd9\u4e2a\u8d85\u65f6\u662f\u5fc5\u9700\u7684\uff0c\u56e0\u4e3a\u5e94\u7528\u7a0b\u5e8f\u7684\u90e8\u5206\u5360\u4f4d\u5206\u914d\u53ef\u80fd\u4f1a\u5360\u7528\u96c6\u7fa4\u8d44\u6e90\u800c\u6ca1\u6709\u771f\u6b63\u4f7f\u7528\u5b83\u4eec\u3002"),(0,o.kt)("p",null,"\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u6392\u961f\u7b49\u5f85\u672a\u77e5\u65f6\u95f4\uff0c\u7b49\u5f85\u5360\u4f4d\u5206\u914d\u5f00\u59cb\u3002\n\u56e0\u6b64\uff0c\u5360\u4f4d\u8bf7\u6c42\u7684\u8d85\u65f6\u4e0d\u80fd\u4e0e\u5e94\u7528\u7a0b\u5e8f\u6216\u8bf7\u6c42\u7684\u521b\u5efa\u76f8\u5173\u8054\u3002\n\u8d85\u65f6\u5fc5\u987b\u5728\u5206\u914d\u7b2c\u4e00\u4e2a\u5360\u4f4d\u8bf7\u6c42\u65f6\u5f00\u59cb\u3002"),(0,o.kt)("p",null,"\u5728\u6240\u6709\u5360\u4f4d\u8bf7\u6c42\u90fd\u88ab\u5206\u914d\u4e4b\u524d\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e0d\u80fd\u8bf7\u6c42\u771f\u6b63\u7684\u5206\u914d\u3002\n\u5360\u4f4d\u8bf7\u6c42\u4e5f\u7531 shim \u8ddf\u8e2a\uff0c\u56e0\u4e3a\u5b83\u4ee3\u8868\u4e00\u4e2a pod\u3002\n\u5728\u6838\u5fc3\u4e2d\u91ca\u653e\u8bf7\u6c42\u9700\u8981\u6d88\u606f\u5728\u6838\u5fc3\u548c shim \u4e4b\u95f4\u6d41\u52a8\u4ee5\u91ca\u653e\u8be5\u8bf7\u6c42\u3002\n\u4f46\u662f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5206\u914d\u9884\u7559\u8d44\u6e90\u7684\u8d85\u65f6\u4f1a\u89e6\u53d1\u5e94\u7528\u7a0b\u5e8f\u5931\u8d25\u3002\n\u5f53\u8d85\u65f6\u88ab\u89e6\u53d1\u5e76\u4e14\u5360\u4f4d\u8bf7\u6c42\u6302\u8d77\u65f6\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c06\u4ece\u5b83\u6240\u5904\u7684\u72b6\u6001\u8f6c\u6362\u4e3a ",(0,o.kt)("em",{parentName:"p"},"killed")," \u3002"),(0,o.kt)("p",null,"\u672c\u6848\u4f8b\u7684\u5e94\u7528\u72b6\u6001\u53ef\u4ee5\u6982\u62ec\u4e3a\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u7533\u8bf7\u72b6\u6001\u4e3a ",(0,o.kt)("em",{parentName:"li"},"accepted")),(0,o.kt)("li",{parentName:"ul"},"\u5360\u4f4d\u5206\u914d\u7684\u8d44\u6e90\u5927\u4e8e\u96f6\uff0c\u5e76\u4e14\u5c0f\u4e8e ",(0,o.kt)("em",{parentName:"li"},"AddApplicationRequest")," \u4e2d\u7684 ",(0,o.kt)("em",{parentName:"li"},"placeholderAsk")),(0,o.kt)("li",{parentName:"ul"},"\u5f85\u5904\u7406\u8d44\u6e90\u8bf7\u6c42\u5927\u4e8e\u96f6")),(0,o.kt)("p",null,"\u8fdb\u5165 ",(0,o.kt)("em",{parentName:"p"},"killed")," \u72b6\u6001\u5fc5\u987b\u81ea\u52a8\u5c06\u5e94\u7528\u7a0b\u5e8f\u79fb\u51fa\u961f\u5217\u3002"),(0,o.kt)("p",null,"\u72b6\u6001\u66f4\u6539\u548c\u5360\u4f4d\u5206\u914d\u91ca\u653e\u53ef\u4ee5\u5728\u5355\u4e2a\u66f4\u65b0\u54cd\u5e94\u6d88\u606f\u4e2d\u5904\u7406\u3002 \u8be5\u6d88\u606f\u5c06\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"UpdatedApplication")," \u7528\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7684\u72b6\u6001\u53d8\u5316"),(0,o.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u6216\u591a\u4e2a ",(0,o.kt)("em",{parentName:"li"},"AllocationRelease")," \u6d88\u606f\uff0c\u6bcf\u4e2a\u5360\u4f4d\u4e00\u4e2a\uff0c",(0,o.kt)("em",{parentName:"li"},"TerminationType")," \u8bbe\u7f6e\u4e3a TIMEOUT"),(0,o.kt)("li",{parentName:"ul"},"\u4e00\u6761\u6216\u591a\u6761 ",(0,o.kt)("em",{parentName:"li"},"TerminationType")," \u8bbe\u7f6e\u4e3a TIMEOUT \u7684 AllocationAskRelease \u6d88\u606f")),(0,o.kt)("p",null,"shim \u9996\u5148\u5904\u7406 AllocationAskRelease \u6d88\u606f\uff0c\u7136\u540e\u662f ",(0,o.kt)("em",{parentName:"p"},"AllocationResponse")," \u6d88\u606f\uff0c\u6700\u540e\u662f ",(0,o.kt)("em",{parentName:"p"},"UpdatedApplication")," \u6d88\u606f\u3002\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u5728\u6838\u5fc3\u7aef\u66f4\u6539\u4e3a ",(0,o.kt)("em",{parentName:"p"},"killed")," \u72b6\u6001\u4ec5\u53d6\u51b3\u4e8e\u79fb\u9664\u6240\u6709\u5360\u4f4d pod\uff0c\u800c\u4e0d\u53d6\u51b3\u4e8e\u5bf9 ",(0,o.kt)("em",{parentName:"p"},"UpdatedApplication")," \u6d88\u606f\u7684\u54cd\u5e94\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"\u5360\u4f4d\u8d85\u65f6",src:a(8225).Z})),(0,o.kt)("p",null,"\u5360\u4f4d\u8d85\u65f6\u671f\u95f4 shim \u548c\u6838\u5fc3\u7684\u7ec4\u5408\u6d41\u7a0b\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u6838\u5fc3\u8d85\u65f6\u5360\u4f4d\u5206\u914d\u3002 (1)"),(0,o.kt)("li",{parentName:"ul"},"\u5220\u9664\u5360\u4f4d\u5206\u914d\u88ab\u4f20\u9012\u5230 shim\u3002 (2)"),(0,o.kt)("li",{parentName:"ul"},"\u6240\u6709\u5360\u4f4d\u5206\u914d\u90fd\u7531 shim \u91ca\u653e\uff0c\u5e76\u4f20\u56de\u6838\u5fc3\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u5220\u9664\u5360\u4f4d\u5206\u914d\u8bf7\u6c42\u88ab\u4f20\u9012\u7ed9 shim\u3002 (3)"),(0,o.kt)("li",{parentName:"ul"},"\u6240\u6709\u5360\u4f4d\u5206\u914d\u8bf7\u6c42\u90fd\u7531 shim \u91ca\u653e\uff0c\u5e76\u4f20\u56de\u6838\u5fc3\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u5728\u5360\u4f4d\u5206\u914d\u548c\u8bf7\u6c42\u88ab\u91ca\u653e\u540e\uff0c\u6838\u5fc3\u5c06\u5e94\u7528\u7a0b\u5e8f\u79fb\u52a8\u5230\u7ec8\u6b62\u72b6\u6001\uff0c\u5c06\u5176\u4ece\u961f\u5217\u4e2d\u79fb\u9664 (4)\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u72b6\u6001\u66f4\u6539\u5728\u6838\u5fc3\u548c shim \u4e2d\u5b8c\u6210\u3002 (5) ")),(0,o.kt)("p",null,"\u5df2\u5206\u914d\u7684\u5360\u4f4d\uff1a\n\u5269\u4f59\u7684\u5360\u4f4d\u9700\u8981\u7531\u6838\u5fc3\u91ca\u653e\u3002\n\u9700\u8981\u901a\u77e5 shim \u5c06\u5b83\u4eec\u79fb\u9664\u3002\u8fd9\u5fc5\u987b\u5728\u8fdb\u5165 ",(0,o.kt)("em",{parentName:"p"},"\u5b8c\u6210")," \u72b6\u6001\u65f6\u89e6\u53d1\u3002\n\u5728\u6838\u5fc3\u8bf7\u6c42\u91ca\u653e\u5360\u4f4d\u4e4b\u540e\uff0c\u5e94\u7528\u7a0b\u5e8f\u7684\u72b6\u6001\u8f6c\u6362\u53ef\u4ee5\u7ee7\u7eed\u3002\n\u6838\u5fc3\u5c06\u5904\u7406\u4ece shim \u8fd4\u56de\u7684\u5360\u4f4d\u5206\u914d\u7684 ",(0,o.kt)("em",{parentName:"p"},"AllocationRelease")," \u6d88\u606f\uff0c\u5e76\u5c06 ",(0,o.kt)("em",{parentName:"p"},"TerminationType")," \u8bbe\u7f6e\u4e3a\u6b63\u5e38",(0,o.kt)("em",{parentName:"p"},"\u8d85\u65f6"),"\uff0c\u800c\u4e0d\u4f1a\u89e6\u53d1\u72b6\u6001\u66f4\u6539\u3002"),(0,o.kt)("p",null,"\u72b6\u6001\u66f4\u6539\u548c\u5360\u4f4d\u5206\u914d\u91ca\u653e\u53ef\u4ee5\u5728\u5355\u4e2a\u66f4\u65b0\u54cd\u5e94\u6d88\u606f\u4e2d\u5904\u7406\u3002\n\u8be5\u6d88\u606f\u5c06\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"UpdatedApplication")," \u7528\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7684\u72b6\u6001\u53d8\u5316"),(0,o.kt)("li",{parentName:"ul"},"\u96f6\u4e2a\u6216\u591a\u4e2a ",(0,o.kt)("em",{parentName:"li"},"AllocationRelease")," \u6d88\u606f\uff0c\u6bcf\u4e2a\u5360\u4f4d\u4e00\u4e2a\uff0c",(0,o.kt)("em",{parentName:"li"},"TerminationType")," \u8bbe\u7f6e\u4e3a ",(0,o.kt)("em",{parentName:"li"},"\u8d85\u65f6"))),(0,o.kt)("p",null,"shim \u9996\u5148\u5904\u7406 ",(0,o.kt)("em",{parentName:"p"},"AllocationResponse")," \u6d88\u606f\uff0c\u7136\u540e\u662f ",(0,o.kt)("em",{parentName:"p"},"UpdatedApplication")," \u6d88\u606f\u3002\n\u5e94\u7528\u7a0b\u5e8f\u72b6\u6001\u5728\u6838\u5fc3\u7aef\u66f4\u6539\u4e3a ",(0,o.kt)("em",{parentName:"p"},"\u5b8c\u6210")," \u72b6\u6001\u4ec5\u4f9d\u8d56\u4e8e\u6240\u6709\u5360\u4f4d pod \u7684\u79fb\u9664\uff0c\u800c\u4e0d\u4f9d\u8d56\u4e8e\u5bf9 ",(0,o.kt)("em",{parentName:"p"},"UpdatedApplication")," \u6d88\u606f\u7684\u54cd\u5e94\u3002"),(0,o.kt)("p",null,"\u8fdb\u5165 ",(0,o.kt)("em",{parentName:"p"},"\u5b8c\u6210")," \u72b6\u6001\u4f1a\u81ea\u52a8\u5c06\u5e94\u7528\u7a0b\u5e8f\u79fb\u51fa\u961f\u5217\u3002\n\u8fd9\u4e5f\u5e94\u8be5\u5904\u7406\u6211\u4eec\u4e4b\u524d\u8ba8\u8bba\u7684\u53ef\u80fd\u5ef6\u8fdf\u5904\u7406\u6765\u81ea shim \u7684\u8bf7\u6c42\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u4ee5\u5728\u9700\u8981\u65f6\u4ece ",(0,o.kt)("em",{parentName:"p"},"\u7b49\u5f85")," \u79fb\u56de ",(0,o.kt)("em",{parentName:"p"},"\u6267\u884c\u4e2d")," \u3002\n\u4e00\u4e2a ",(0,o.kt)("em",{parentName:"p"},"\u5b8c\u6210")," \u7684\u5e94\u7528\u7a0b\u5e8f\u4e5f\u4e0d\u5e94\u8be5\u963b\u6b62\u56f4\u7ed5cron\u8ba8\u8bba\u7684\u60c5\u51b5\uff0c\u4f8b\u5982\u6bcf\u6b21\u8c03\u7528\u4f7f\u7528\u76f8\u540c\u7684\u5e94\u7528\u7a0b\u5e8fID\u63d0\u4ea4\u3002\n\u5177\u6709\u76f8\u540c\u7533\u8bf7ID\u7684 ",(0,o.kt)("em",{parentName:"p"},"\u5b8c\u6210")," \u7533\u8bf7\u4e0d\u5f97\u963b\u6b62\u63d0\u4ea4\u5177\u6709\u76f8\u540cID\u7684\u65b0\u7533\u8bf7\u3002 "),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"\u5e94\u7528\u7a0b\u5e8f\u6e05\u7406\u6d41\u7a0b",src:a(2334).Z}),"\ncation to the completed state removing it from the queue (6)."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The state change is finalised in the core and shim. (7)\n\u5728\u6e05\u7406\u5e94\u7528\u7a0b\u5e8f\u671f\u95f4 shim \u548c\u6838\u5fc3\u7684\u7ec4\u5408\u6d41\u7a0b\uff1a"),(0,o.kt)("li",{parentName:"ul"},"\u5728 Kubernetes \u5c42\u53d1\u5e03\u4e86\u4e00\u4e2a pod\u3002 (1)"),(0,o.kt)("li",{parentName:"ul"},"shim \u5c06\u5206\u914d\u91ca\u653e\u4f20\u9012\u7ed9\u6838\u5fc3\u3002 (2)"),(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u6ca1\u6709\u6302\u8d77\u6216\u6d3b\u52a8\u7684\u5206\u914d\uff0c\u6838\u5fc3\u4f1a\u5c06\u5e94\u7528\u7a0b\u5e8f\u8f6c\u6362\u4e3a\u7b49\u5f85\u72b6\u6001\u3002 (3)"),(0,o.kt)("li",{parentName:"ul"},"\u7b49\u5f85\u72b6\u6001\u8d85\u65f6\u5e76\u89e6\u53d1\u6e05\u7406\u3002 (4)"),(0,o.kt)("li",{parentName:"ul"},"\u5220\u9664\u5360\u4f4d\u7b26\u914d\u88ab\u4f20\u9012\u5230 shim\u3002 (5)"),(0,o.kt)("li",{parentName:"ul"},"\u6240\u6709\u5360\u4f4d\u5206\u914d\u90fd\u7531 shim \u91ca\u653e\uff0c\u5e76\u4f20\u56de\u6838\u5fc3\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u91ca\u653e\u6240\u6709\u5360\u4f4d\u540e\uff0c\u6838\u5fc3\u5c06\u5e94\u7528\u7a0b\u5e8f\u79fb\u52a8\u5230\u5b8c\u6210\u72b6\u6001\uff0c\u5c06\u5176\u4ece\u961f\u5217\u4e2d\u5220\u9664 (6)\u3002"),(0,o.kt)("li",{parentName:"ul"},"\u72b6\u6001\u66f4\u6539\u5728\u6838\u5fc3\u548c shim \u4e2d\u5b8c\u6210\u3002 (7) ")),(0,o.kt)("h2",{id:"\u5e94\u7528\u6062\u590d"},"\u5e94\u7528\u6062\u590d"),(0,o.kt)("p",null,"\u5728\u5e94\u7528\u7a0b\u5e8f\u6062\u590d\u671f\u95f4\uff0c\u5360\u4f4d Pod \u4e0e\u8282\u70b9\u4e0a\u7684\u4efb\u4f55\u5176\u4ed6 Pod \u4e00\u6837\u88ab\u6062\u590d\u3002\n\u8fd9\u4e9b pod \u7531 shim \u4f5c\u4e3a\u8282\u70b9\u73b0\u6709\u5206\u914d\u7684\u4e00\u90e8\u5206\u4f20\u9012\u5230\u6838\u5fc3\u3002\n\u73b0\u6709\u7684\u5206\u914d\u5728\u6838\u5fc3\u4e2d\u6ca1\u6709\u76f8\u5e94\u7684 ",(0,o.kt)("em",{parentName:"p"},"\u5206\u914d\u8bf7\u6c42"),"\u3002 \u6838\u5fc3\u6839\u636e\u6062\u590d\u7684\u4fe1\u606f\u751f\u6210 ",(0,o.kt)("em",{parentName:"p"},"\u5206\u914d\u8bf7\u6c42")," \u3002"),(0,o.kt)("p",null,"\u5bf9\u4e8e\u8054\u90a6\u8c03\u5ea6\uff0c",(0,o.kt)("em",{parentName:"p"},"\u5206\u914d\u8bf7\u6c42")," \u5305\u542b ",(0,o.kt)("em",{parentName:"p"},"\u4efb\u52a1\u7ec4\u540d\u79f0")," \u548c ",(0,o.kt)("em",{parentName:"p"},"\u5360\u4f4d")," \u6807\u5fd7\u3002\n\u5728\u6062\u590d\u671f\u95f4\uff0c\u76f8\u540c\u7684\u4fe1\u606f\u5fc5\u987b\u662f ",(0,o.kt)("em",{parentName:"p"},"\u5206\u914d")," \u6d88\u606f\u7684\u4e00\u90e8\u5206\u3002\n\u8fd9\u662f\u56e0\u4e3a\u5728\u4e24\u4e2a\u65b9\u5411\u4e0a\u4f7f\u7528\u76f8\u540c\u7684\u6d88\u606f\uff0c\u4ece RM \u5230\u8c03\u5ea6\u5668\uff0c\u53cd\u4e4b\u4ea6\u7136\uff0c\u8fd9\u610f\u5473\u7740\u6211\u4eec\u9700\u8981\u66f4\u65b0\u6d88\u606f\u53ca\u5176\u5904\u7406\u3002"),(0,o.kt)("p",null,"\u5982\u679c ",(0,o.kt)("em",{parentName:"p"},"\u5206\u914d")," \u6d88\u606f\u4e2d\u7f3a\u5c11\u4fe1\u606f\uff0c\u5219\u6062\u590d\u7684\u5206\u914d\u5c06\u4e0d\u4f1a\u5728\u6838\u5fc3\u4e2d\u88ab\u6b63\u786e\u6807\u8bb0\u3002\n\u6062\u590d\u7684\u5206\u914d\u5c06\u88ab\u89c6\u4e3a\u5e38\u89c4\u5206\u914d\u3002\n\u8fd9\u610f\u5473\u7740\u5b83\u4f5c\u4e3a\u66ff\u6362\u5360\u4f4d\u7684\u6b63\u5e38\u5206\u914d\u5468\u671f\u7684\u4e00\u90e8\u5206\u88ab\u8df3\u8fc7\u3002"),(0,o.kt)("p",null,"\u903b\u8f91\u53d8\u5316\u53ea\u9700\u8981\u73b0\u6709\u5206\u914d\u7684\u6062\u590d\u5c06\u63a5\u53e3\u6d88\u606f\u4e2d\u7684\u5b57\u6bb5\u590d\u5236\u5230\u5185\u6838\u4e2d\u7684\u5206\u914d\u5bf9\u8c61\u4e2d\u3002"),(0,o.kt)("h2",{id:"\u63a5\u53e3\u53d8\u5316"},"\u63a5\u53e3\u53d8\u5316"),(0,o.kt)("p",null,"\u9700\u8981\u5bf9 shim \u548c\u6838\u5fc3\u4e4b\u95f4\u7684\u901a\u4fe1\u8fdb\u884c\u591a\u6b21\u66f4\u6539\uff0c\u4ee5\u652f\u6301\u6240\u9700\u7684\u5e2e\u6d3e\u4fe1\u606f\u3002"),(0,o.kt)("p",null,"\u5e94\u7528\u7a0b\u5e8f\u5fc5\u987b\u63d0\u4f9b\u5360\u4f4d\u8bf7\u6c42\u7684\u603b\u5927\u5c0f\uff0c\u4ee5\u9632\u6b62\u63a5\u53d7\u6c38\u8fdc\u65e0\u6cd5\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u3002"),(0,o.kt)("p",null,"\u4ece shim \u53d1\u9001\u5230\u6838\u5fc3\u4ee5\u8fdb\u884c\u5206\u914d\u8bf7\u6c42\u7684\u5f53\u524d\u5bf9\u8c61\u5728 AllocationAsk \u4e2d\u5b9a\u4e49\u3002\n\u7531\u4e8e\u4ece\u8c03\u5ea6\u5668\u6838\u5fc3\u4f20\u56de\u7684\u7ed3\u679c\u6d88\u606f\u4e0d\u4f1a\u66f4\u6539\uff0c\u56e0\u6b64\u5206\u914d\u4e0d\u4f1a\u66f4\u6539\u3002\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u4f7f\u7528\u76f8\u540c\u5206\u914d\u6d88\u606f\u4ece shim \u5230\u6838\u5fc3\u7684\u6062\u590d\uff0c\u5fc5\u987b\u5305\u542b\u4e0e\u5e2e\u6d3e\u76f8\u5173\u7684\u5b57\u6bb5\u3002\n\u5fc5\u987b\u5c06\u4e0e\u5e2e\u6d3e\u76f8\u5173\u7684\u5b57\u6bb5\u6dfb\u52a0\u5230\u8fd9\u4e24\u4e2a\u6d88\u606f\u4e2d\u3002"),(0,o.kt)("p",null,"\u5206\u914d\u91ca\u653e\u8bf7\u6c42\u548c\u54cd\u5e94\u8bf7\u6c42\u9700\u8981\u652f\u6301\u53cc\u5411\u901a\u4fe1\uff0c\u5e76\u4e14\u9700\u8981\u8fdb\u884c\u91cd\u5927\u66f4\u6539\u3002"),(0,o.kt)("h3",{id:"addapplication"},"AddApplication"),(0,o.kt)("p",null,"The AddApplicationRequest message requires a new field to communicate the total placeholder resource request that will be requested.\nThe field is used to reject the application if it is impossible to satisfy the request.\nIt can also be used to stop the core from scheduling any real pods for that application until all placeholder pods are processed."),(0,o.kt)("p",null,"In patched message form that would look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"message AddApplicationRequest {\n...\n  // The total amount of resources gang placeholders will request\n  Resource placeholderAsk = 7;\n...\n}\n")),(0,o.kt)("h3",{id:"allocationask"},"AllocationAsk"),(0,o.kt)("p",null,"The first part of the change is the base information for the task group.\nThis will require an additional optional attribute to be added.\nThe content of this optional attribute is a name, a string, which will be mapped to the name of the task group.\nThe field can be present on a real allocation and on a placeholder."),(0,o.kt)("p",null,"Proposed name for the new field is: ",(0,o.kt)("em",{parentName:"p"},"taskGroupName")),(0,o.kt)("p",null,"To distinguish normal AllocationAsks and placeholder AllocationAsks a flag must be added.\nThe flag will never have more than two values and thus maps to a boolean. As the default value for a boolean is ",(0,o.kt)("em",{parentName:"p"},"false")," the field should show the fact that it is an AllocationAsk that represents a placeholder as true."),(0,o.kt)("p",null,"Proposed name for the field is: ",(0,o.kt)("em",{parentName:"p"},"placeholder")),(0,o.kt)("p",null,"In patched message form that would look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"message AllocationAsk {\n...\n  // The name of the TaskGroup this ask belongs to\n  string taskGroupName = 10;\n  // Is this a placeholder ask (true) or a real ask (false), defaults to false\n  // ignored if the taskGroupName is not set\n  bool placeholder = 11;\n...\n}\n")),(0,o.kt)("p",null,"The last part of the task group information that needs to be communicated is the size of the task group.\nThis does not require a change in the interface as the current AllocationAsk object can support both possible options."),(0,o.kt)("p",null,"Requests can be handled in two ways:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Each member of the task group is passed to the core as a separate AllocationAsk with a maxAllocations, or the ask repeat, of 1"),(0,o.kt)("li",{parentName:"ol"},"The task group is considered one AllocationAsk with a maxAllocations set to the same value as minMember of the task group information.")),(0,o.kt)("p",null,"With option A the shim will need to generate multiple AllocationAsk objects and pass each to the core for scheduling.\nEach AllocationAsk is linked to one pod.\nOption B will only generate one AllocationAsk for all placeholder pods.\nOption B requires less code and has less overhead on the core side.\nHowever the logic on the shim side might be more complex as the returned allocation needs to be linked to just one pod."),(0,o.kt)("p",null,"Proposal is to use option: A"),(0,o.kt)("h3",{id:"allocation"},"Allocation"),(0,o.kt)("p",null,"Similar to the change for the ",(0,o.kt)("em",{parentName:"p"},"AllocationAsk")," the ",(0,o.kt)("em",{parentName:"p"},"Allocation")," requires additional optional attributes to be added.\nThe new fields distinguish a normal Allocation and placeholder Allocations on recovery.\nThe same rules apply to these fields as the ones added to the ",(0,o.kt)("em",{parentName:"p"},"AllocationAsk"),"."),(0,o.kt)("p",null,"The content of this optional attribute is a name, a string, which will be mapped to the name of the task group.\nThe field can be present on a real allocation and on a placeholder."),(0,o.kt)("p",null,"Proposed name for the new field is: ",(0,o.kt)("em",{parentName:"p"},"taskGroupName")),(0,o.kt)("p",null,"The flag will never have more than two values and thus maps to a boolean.\nAs the default value for a boolean is ",(0,o.kt)("em",{parentName:"p"},"false")," the field should show the fact that it is an Allocation that represents a placeholder as true."),(0,o.kt)("p",null,"Proposed name for the field is: ",(0,o.kt)("em",{parentName:"p"},"placeholder")),(0,o.kt)("p",null,"In patched message form that would look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"message Allocation {\n...\n  // The name of the TaskGroup this allocation belongs to\n  string taskGroupName = 11;\n  // Is this a placeholder allocation (true) or a real allocation (false), defaults to false\n  // ignored if the taskGroupName is not set\n  bool placeholder = 12;\n...\n}\n")),(0,o.kt)("h3",{id:"allocationrelease-response-and-request"},"AllocationRelease Response and Request"),(0,o.kt)("p",null,"The name for the messages are based on the fact that the release is always triggered by the shim.\nIn case of preemption and or gang scheduling the release is not triggered from the shim but from the core.\nThat means the message name does not cover the usage. A response message might not have an associated request message.\nIt could be used to indicate direction but that is in this case confusing."),(0,o.kt)("p",null,"When a release is triggered from the core, for preemption or the placeholder allocation, a response is expected from the shim to confirm that the release has been processed.\nThis response must be distinguished from a request to release the allocation initiated by the shim.\nA release initiated by the shim must be followed by a confirmation from the core to the shim that the message is processed.\nFor releases initiated by the core no such confirmation message can or must be sent.\nIn the current request message there is no way to indicate that it is a confirmation message."),(0,o.kt)("p",null,"To fix the possible confusing naming the proposal is to merge the two messages into one message: ",(0,o.kt)("em",{parentName:"p"},"AllocationRelease"),"."),(0,o.kt)("p",null,"The ",(0,o.kt)("em",{parentName:"p"},"AllocationReleaseRequest")," is indirectly part of the ",(0,o.kt)("em",{parentName:"p"},"UpdateRequest")," message as it is contained in the ",(0,o.kt)("em",{parentName:"p"},"AllocationReleasesRequest"),".\nThe ",(0,o.kt)("em",{parentName:"p"},"AllocationReleaseResponse")," is part of the ",(0,o.kt)("em",{parentName:"p"},"UpdateResponse")," message.\nThe flow-on effect of the rename and merge of the two messages is a change in the two messages that contain them.\nThe message changes for ",(0,o.kt)("em",{parentName:"p"},"UpdateResponse")," and ",(0,o.kt)("em",{parentName:"p"},"AllocationReleasesRequest")," are limited to type changes of the existing fields."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Message"),(0,o.kt)("th",{parentName:"tr",align:null},"Field ID"),(0,o.kt)("th",{parentName:"tr",align:null},"Old type"),(0,o.kt)("th",{parentName:"tr",align:null},"New type"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"UpdateResponse"),(0,o.kt)("td",{parentName:"tr",align:null},"3"),(0,o.kt)("td",{parentName:"tr",align:null},"AllocationReleaseResponse"),(0,o.kt)("td",{parentName:"tr",align:null},"AllocationRelease")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"AllocationReleasesRequest"),(0,o.kt)("td",{parentName:"tr",align:null},"1"),(0,o.kt)("td",{parentName:"tr",align:null},"AllocationReleaseRequest"),(0,o.kt)("td",{parentName:"tr",align:null},"AllocationRelease")))),(0,o.kt)("p",null,"In patched message form that would look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"message UpdateResponse {\n...\n  // Released allocation(s), allocations can be released by either the RM or scheduler.\n  // The TerminationType defines which side needs to act and process the message. \n  repeated AllocationRelease releasedAllocations = 3;\n...\n}\n\nmessage AllocationReleasesRequest {\n  // Released allocation(s), allocations can be released by either the RM or scheduler.\n  // The TerminationType defines which side needs to act and process the message. \n  repeated AllocationRelease releasedAllocations = 1;\n...\n}\n")),(0,o.kt)("p",null,"The merged message ",(0,o.kt)("em",{parentName:"p"},"AllocationRelease")," will consist of:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Field name"),(0,o.kt)("th",{parentName:"tr",align:null},"Content type"),(0,o.kt)("th",{parentName:"tr",align:null},"Required"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"partitionName"),(0,o.kt)("td",{parentName:"tr",align:null},"string"),(0,o.kt)("td",{parentName:"tr",align:null},"yes")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"applicationID"),(0,o.kt)("td",{parentName:"tr",align:null},"string"),(0,o.kt)("td",{parentName:"tr",align:null},"no")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"UUID"),(0,o.kt)("td",{parentName:"tr",align:null},"string"),(0,o.kt)("td",{parentName:"tr",align:null},"no")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"terminationType"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("em",{parentName:"td"},"TerminationType")),(0,o.kt)("td",{parentName:"tr",align:null},"yes")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"message"),(0,o.kt)("td",{parentName:"tr",align:null},"string"),(0,o.kt)("td",{parentName:"tr",align:null},"no")))),(0,o.kt)("p",null,"Confirmation behaviour of the action should be triggered on the type of termination received.\nThe core will confirm the release to the shim of all types that originate in the shim and vice versa."),(0,o.kt)("p",null,"A confirmation or response uses the same ",(0,o.kt)("em",{parentName:"p"},"TerminationType")," as was set in the original message.\nAn example of this is a pod that is removed from K8s will trigger an ",(0,o.kt)("em",{parentName:"p"},"AllocationRelease _message to be sent from the shim to the core with the TerminationType STOPPED_BY_RM. The core processes the request removing the allocation from the internal structures, and when all processing is done it responds to the shim with a message using the same _TerminationType"),".\nThe shim can ignore that or make follow up changes if needed."),(0,o.kt)("p",null,"A similar process happens for a release that originates in the core.\nExample of the core sending an ",(0,o.kt)("em",{parentName:"p"},"AllocationRelease")," message to the shim using the ",(0,o.kt)("em",{parentName:"p"},"TerminationType")," PREEMPTED_BY_SCHEDULER.\nThe shim handles that by releasing the pod identified and responds to the core that it has released the pod.\nOn receiving the confirmation that the pod has been released the core can progress with the allocation and preemption processing."),(0,o.kt)("p",null,"In patched message form that would look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"message AllocationRelease {\n  enum TerminationType {\n    STOPPED_BY_RM = 0;\n    TIMEOUT = 1; \n    PREEMPTED_BY_SCHEDULER = 2;\n    PLACEHOLDER_REPLACED = 3;\n  }\n\n  // The name of the partition the allocation belongs to\n  string partitionName = 1;\n  // The application the allocation belongs to\n  string applicationID = 2;\n  // The UUID of the allocation to release, if not set all allocations are released for\n  // the applicationID\n  string UUID = 3;\n  // The termination type as described above \n  TerminationType terminationType = 4;\n  // human-readable message\n  string message = 5;\n}\n")),(0,o.kt)("h3",{id:"terminationtype"},"TerminationType"),(0,o.kt)("p",null,"The currently defined ",(0,o.kt)("em",{parentName:"p"},"TerminationType")," values and specification of the side that generates (Sender), and the side that actions and confirms processing (Receiver):"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Value"),(0,o.kt)("th",{parentName:"tr",align:null},"Sender"),(0,o.kt)("th",{parentName:"tr",align:null},"Receiver"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"STOPPED_BY_RM"),(0,o.kt)("td",{parentName:"tr",align:null},"shim"),(0,o.kt)("td",{parentName:"tr",align:null},"core")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"TIMEOUT *"),(0,o.kt)("td",{parentName:"tr",align:null},"core"),(0,o.kt)("td",{parentName:"tr",align:null},"shim")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"PREEMPTED_BY_SCHEDULER *"),(0,o.kt)("td",{parentName:"tr",align:null},"core"),(0,o.kt)("td",{parentName:"tr",align:null},"shim")))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"currently not handled by the shim, core or both")),(0,o.kt)("p",null,"When the placeholder allocation gets released the ",(0,o.kt)("em",{parentName:"p"},"AllocationReleaseResponse")," is used to communicate the release back from the core to the shim.\nThe response contains an enumeration called ",(0,o.kt)("em",{parentName:"p"},"TerminationType"),", and a human-readable message.\nFor tracking and tracing purposes we should add a new ",(0,o.kt)("em",{parentName:"p"},"TerminationType")," specifically for the placeholder replacement. The shim must take action based on the type and confirm the allocation release to the core."),(0,o.kt)("p",null,"It should provide enough detail so we do not have to re-use an already existing type, or the human-readable message.\nThe human-readable format can still be used to provide further detail on which new allocation replaced the placeholder."),(0,o.kt)("p",null,"Proposal is to add: ",(0,o.kt)("em",{parentName:"p"},"PLACEHOLDER_REPLACED")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Value"),(0,o.kt)("th",{parentName:"tr",align:null},"Sender"),(0,o.kt)("th",{parentName:"tr",align:null},"Receiver"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"PLACEHOLDER_REPLACED"),(0,o.kt)("td",{parentName:"tr",align:null},"shim"),(0,o.kt)("td",{parentName:"tr",align:null},"core")))),(0,o.kt)("p",null,"As part of the Scheduler Interface cleanup (",(0,o.kt)("a",{parentName:"p",href:"https://issues.apache.org/jira/browse/YUNIKORN-486"},"YUNIKORN-486"),") the ",(0,o.kt)("em",{parentName:"p"},"TerminationType")," should be extracted from the ",(0,o.kt)("em",{parentName:"p"},"AllocationRelease")," and ",(0,o.kt)("em",{parentName:"p"},"AllocationaskRelease")," message.\nIt is an enumeration that can be shared between multiple objects.\n",(0,o.kt)("a",{parentName:"p",href:"https://issues.apache.org/jira/browse/YUNIKORN-547"},"YUNIKORN-547")," has been logged to handle this as it has an impact on the code outside of the scope of gang scheduling."),(0,o.kt)("h3",{id:"allocationaskrelease-response-and-request"},"AllocationAskRelease Response and Request"),(0,o.kt)("p",null,"The allocation ask release right now can only be triggered by the shim.\nIn order for the core to perform the cleanup when the placeholder allocation times out, we need to make this a bidirectional message.\nSimilarly to the Allocation we would rename the ",(0,o.kt)("em",{parentName:"p"},"AllocationAskReleaseRequest")," to ",(0,o.kt)("em",{parentName:"p"},"AllocationAskRelease"),", so we can use this message in both directions:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"message AllocationReleasesRequest {\n...\n  // Released allocationask(s), allocationasks can be released by either the RM or\n  // scheduler. The TerminationType defines which side needs to act and process the\n  // message. \n  repeated AllocationAskRelease allocationAsksToRelease = 2;\n}\n")),(0,o.kt)("p",null,"Similar processing logic based on the ",(0,o.kt)("em",{parentName:"p"},"TerminationType")," which is used for allocations should be used for ask releases.\nIn patched message form that would look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"message AllocationAskRelease {\n  enum TerminationType {\n    STOPPED_BY_RM = 0;\n    TIMEOUT = 1; \n    PREEMPTED_BY_SCHEDULER = 2;\n    PLACEHOLDER_REPLACED = 3;\n  }\n...\n  // The termination type as described above \n  TerminationType terminationType = 4;\n...\n}\n")),(0,o.kt)("p",null,"Confirmation behaviour of the action should be triggered on the type of termination received.\nThe core will confirm the release to the shim of all types that originate in the shim and vice versa."),(0,o.kt)("p",null,"A confirmation or response uses the same ",(0,o.kt)("em",{parentName:"p"},"TerminationType")," as was set in the original message."),(0,o.kt)("h2",{id:"scheduler-storage-object-changes"},"Scheduler storage object changes"),(0,o.kt)("h3",{id:"allocationask-1"},"AllocationAsk"),(0,o.kt)("p",null,"In line with the changes for the communication the objects in the scheduler also need to be modified to persist some of the detail communicated.\nThe AllocationAsk that is used in the communication has an equivalent object inside the scheduler with the same name.\nThis object needs to be able to store the new fields proposed above."),(0,o.kt)("p",null,"Proposed new fields: ",(0,o.kt)("em",{parentName:"p"},"taskGroupName")," and ",(0,o.kt)("em",{parentName:"p"},"placeholder"),"."),(0,o.kt)("p",null,"In the current interface specification a field called ",(0,o.kt)("em",{parentName:"p"},"executionTimeoutMilliSeconds")," is defined.\nThis is currently not mapped to the object inside the scheduler and should be added.\nTime or Duration are stored as native go objects and do not include a size specifier."),(0,o.kt)("p",null,"Proposed new field: ",(0,o.kt)("em",{parentName:"p"},"execTimeout")),(0,o.kt)("h3",{id:"allocation-1"},"Allocation"),(0,o.kt)("p",null,"After the allocation is made an Allocation object is created in the core to track the real allocation. This Allocation object is directly linked to the application and should show that the allocation is a placeholder and for which task group. This detail is needed to also enable the correct display of the resources used in the web UI."),(0,o.kt)("p",null,"The propagation of the placeholder information could be achieved indirectly as the allocation object references an AllocationAsk. This would require a lookup of the AllocationAsk to assess the type of allocation. We could also opt to propagate the data into the Allocation object itself. This would remove the lookup and allow us to directly filter allocations based on the type and or task group information."),(0,o.kt)("p",null,"From a scheduling and scheduler logic perspective the indirect reference is not really desirable due to the overhead of the lookups required. This means that the same fields added in the AllocationAsk are also added to the Allocation object."),(0,o.kt)("p",null,"Proposed new fields: ",(0,o.kt)("em",{parentName:"p"},"taskGroupName")," and ",(0,o.kt)("em",{parentName:"p"},"placeholder"),"."),(0,o.kt)("p",null,"To support the release of the allocation being triggered from the core tracking of the release action is required. The release is not final until the shim has confirmed that release. However during that time period the allocation may not be released again."),(0,o.kt)("p",null,"Proposed new field: ",(0,o.kt)("em",{parentName:"p"},"released")),(0,o.kt)("p",null,"At the point that we replace the placeholder with a real allocation we need to release an existing placeholder.\nThe Allocation object allows us to specify a list of Allocations to release.\nThis field was added earlier to support preemption.\nThis same field will be reused for the placeholder release."),(0,o.kt)("h3",{id:"application"},"Application"),(0,o.kt)("p",null,"The AddApplicationRequest has a new field added that needs to be persisted in the object inside the scheduler."),(0,o.kt)("p",null,"Proposed new field: ",(0,o.kt)("em",{parentName:"p"},"placeholderAsk")),(0,o.kt)("p",null,"In the current interface specification a field called ",(0,o.kt)("em",{parentName:"p"},"executionTimeoutMilliSeconds")," is defined. This is currently not mapped to the object inside the scheduler and should be added. Time or Duration are stored as native go objects and do not include a size specifier."),(0,o.kt)("p",null,"Proposed new field: ",(0,o.kt)("em",{parentName:"p"},"execTimeout")),(0,o.kt)("p",null,"The application object should be able to track the placeholder allocations separately from the real allocations. The split of the allocation types on the application will allow us to show the proper state in the web UI."),(0,o.kt)("p",null,"Proposed new field: ",(0,o.kt)("em",{parentName:"p"},"allocatedPlaceholder")),(0,o.kt)("h3",{id:"queue--node"},"Queue & Node"),(0,o.kt)("p",null,"No changes at this point.\nThe placeholder allocations should be counted as \u201creal\u201d allocations on the Queue and Node.\nBy counting the placeholder as normal the quota for the queue is enforced as expected.\nThe Node object needs to also show normal usage to prevent interactions with the autoscaler."))}h.isMDXComponent=!0},2334:function(e,t,a){t.Z=a.p+"assets/images/gang_clean_up-c2019679692548acac0667d84feea985.png"},4973:function(e,t,a){t.Z=a.p+"assets/images/gang_generic_flow-7aa03e3ed0477897b3694adeb9e77253.png"},8225:function(e,t,a){t.Z=a.p+"assets/images/gang_timeout-2e8b67c25538a8f49f7c059f113ac1b0.png"},3553:function(e,t,a){t.Z=a.p+"assets/images/gang_total_ask-5962332571a96d36894af545be00f2b2.png"}}]);