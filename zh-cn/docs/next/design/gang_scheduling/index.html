<!doctype html>
<html class="docs-version-current" lang="zh-cn" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="search" type="application/opensearchdescription+xml" title="Apache YuniKorn (Incubating)" href="/zh-cn/opensearch.xml"><title data-react-helmet="true">帮派调度设计 | Apache YuniKorn (Incubating)</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://yunikorn.apache.org/zh-cn/img/logo/yunikorn-logo-main.png"><meta data-react-helmet="true" name="twitter:image" content="https://yunikorn.apache.org/zh-cn/img/logo/yunikorn-logo-main.png"><meta data-react-helmet="true" property="og:url" content="https://yunikorn.apache.org/zh-cn/docs/next/design/gang_scheduling"><meta data-react-helmet="true" name="docsearch:language" content="zh-cn"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="帮派调度设计 | Apache YuniKorn (Incubating)"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><link data-react-helmet="true" rel="icon" href="/zh-cn/img/yunikorn.ico"><link data-react-helmet="true" rel="canonical" href="https://yunikorn.apache.org/zh-cn/docs/next/design/gang_scheduling"><link data-react-helmet="true" rel="alternate" href="https://yunikorn.apache.org/docs/next/design/gang_scheduling" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://yunikorn.apache.org/zh-cn/docs/next/design/gang_scheduling" hreflang="zh-cn"><link data-react-helmet="true" rel="alternate" href="https://yunikorn.apache.org/docs/next/design/gang_scheduling" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh-cn/assets/css/styles.8b714711.css">
<link rel="preload" href="/zh-cn/assets/js/runtime~main.02e225f2.js" as="script">
<link rel="preload" href="/zh-cn/assets/js/main.99e2b574.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">0.12.1 has been released, check the DOWNLOADS</div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-cn/"><div class="navbar__logo"><img src="/zh-cn/img/logo/yunikorn_blue_logo.png" alt="YuniKorn Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/zh-cn/img/logo/yunikorn_white_logo.png" alt="YuniKorn Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Apache YuniKorn</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-cn/docs/">快速开始</a><a class="navbar__item navbar__link" href="/zh-cn/community/roadmap">路线图</a><a class="navbar__item navbar__link" href="/zh-cn/community/download">下载</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">社区</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-cn/community/get_involved">进行参与</a></li><li><a class="dropdown__link" href="/zh-cn/community/how_to_contribute">如何贡献</a></li><li><a class="dropdown__link" href="/zh-cn/community/coding_guidelines">编码指南</a></li><li><a class="dropdown__link" href="/zh-cn/community/reporting_issues">报告问题</a></li><li><a class="dropdown__link" href="/zh-cn/community/events">事件</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Apache软件基金会<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Apache孵化项目<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>事件<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>License<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>赞助商<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>赞助<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Security<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/zh-cn/docs">文档</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh-cn/docs/next/">Master</a></li><li><a class="dropdown__link" href="/zh-cn/docs/">0.12.1</a></li><li><a class="dropdown__link" href="/zh-cn/docs/0.11.0/">0.11.0</a></li><li><a class="dropdown__link" href="/zh-cn/docs/0.10.0/">0.10.0</a></li><li><a class="dropdown__link" href="/zh-cn/docs/0.9.0/">0.9.0</a></li><li><a class="dropdown__link" href="/zh-cn/docs/0.8.0/">0.8.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文</span></span></a><ul class="dropdown__menu"><li><a href="/docs/next/design/gang_scheduling" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/zh-cn/docs/next/design/gang_scheduling" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">中文</a></li></ul></div><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-cn/docs/next/">Get Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-cn/docs/next/user_guide/queue_config">User Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/zh-cn/docs/next/developer_guide/env_setup">Developer Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/developer_guide/env_setup">Dev Environment Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/developer_guide/build">Build and Run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/developer_guide/deployment">Deploy to Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/developer_guide/openshift_development">在 CodeReady 容器中开发</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/zh-cn/docs/next/design/architecture">Designs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/design/architecture">架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/design/scheduler_core_design">Scheduler Core Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/design/cache_removal">调度器缓存删除设计</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/design/k8shim">Kubernetes Shim 设计</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/design/cross_queue_preemption">跨队列抢占</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/design/namespace_resource_quota">命名空间资源配额</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/design/pluggable_app_management">Pluggable App Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/design/resilience">Resilience</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/design/predicates">Support K8s Predicates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/design/scheduler_configuration">Scheduler Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/design/state_aware_scheduling">Batch Workloads Ordering with StateAware Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/next/design/scheduler_object_states">Scheduler Object States</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-cn/docs/next/design/gang_scheduling">帮派调度设计</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-cn/docs/next/performance/evaluate_perf_function_with_kubemark">Performance</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Apache YuniKorn (Incubating)<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/zh-cn/docs/design/gang_scheduling">latest version</a></b> (<!-- -->0.12.1<!-- -->).</div></div><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->Next</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>帮派调度设计</h1></header><header><h1>帮派调度实现</h1></header><p>一种新的调度应用程序的方法，它考虑了应用程序随着时间的推移预计会产生的资源需求。
它通过预留资源来保证应用程序的预期需求资源。</p><p>这个实现有两个部分：</p><ul><li>Kubernetes Shim</li><li>Core（以后成为核心）和 scheduling (调度)</li></ul><p>本文档描述了核心端的实现。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="文档目标">文档目标<a class="hash-link" href="#文档目标" title="Direct link to heading">​</a></h2><p>本文档描述了以下实现设计要点：</p><ol><li>定义 shim 到核心通信所需的调整（调度器接口）</li><li>调度器存储对象变化</li><li>调度器逻辑变化</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="排除的设计点">排除的设计点<a class="hash-link" href="#排除的设计点" title="Direct link to heading">​</a></h2><p>目前，本设计文档未涵盖 Kubernetes shim 端实现。</p><p>本设计将 <em>不</em> 讨论核心端的广义抢占。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="通用流程">通用流程<a class="hash-link" href="#通用流程" title="Direct link to heading">​</a></h2><p>该流程由应用程序创建的 pod 被提交而触发。
在 Spark 应用程序中，第一个 Pod 是 driver pod。
如果流程是从应用程序 CRD 的创建触发的，则不会有第一个 pod。
然而，这超出了核心调度的逻辑。从核心方面来看，这两种情况应该没有区别。
更多细节在 <a href="#%E8%B0%83%E5%BA%A6%E5%99%A8%E9%80%BB%E8%BE%91%E5%8F%98%E5%8C%96">调度器逻辑变化</a> 章节中。</p><p>提交申请的流程。图中的数字对应于图下方的描述。</p><p><img alt="通用流程" src="/zh-cn/assets/images/gang_generic_flow-7aa03e3ed0477897b3694adeb9e77253.png"></p><p>应用程序启动期间shim和核心的组合流程：</p><ul><li>提交的应用程序定义了任务组。 (1)</li><li>shim 创建应用程序并将应用程序传递给核心。 (2)</li><li>shim 为任务组的每个成员创建 placeholder（占位）pod。 (3)</li><li>按照正常行为，pod 作为具有正确信息集的应用程序的 AllocationAsk（资源分配请求）被处理并传递给核心。 (4)</li><li>占位 AllocationAsk 由核心调度，就好像它们是正常的 AllocationAsk 一样。 (5)</li><li>所有分配，即使它们是由调度器分配的占位 AllocationAsks 的结果，也会被传送回 shim。</li><li>原始的实际 pod 作为 AllocationAsk 传递给核心。 (6)</li><li>在实际 pod 和所有占位 pod 被调度后，shim 启动触发应用程序创建实际 pod。 (7)</li></ul><p>在第一个实际 pod 启动后，以下 pod 都应该以相同的方式处理 (8)：</p><ul><li>在 k8s 上创建了一个实际 pod。</li><li>处理 pod 并创建一个 AllocationAsk。</li><li>调度器处理 AllocationAsk（更多细节见下文）并用实际分配替换预留资源。</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="应用提交处理">应用提交处理<a class="hash-link" href="#应用提交处理" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="预留资源总大小">预留资源总大小<a class="hash-link" href="#预留资源总大小" title="Direct link to heading">​</a></h3><p>如果请求一个或多个任务组，应用程序应该提供它要请求的所有任务组成员的总大小。
如果应用程序在限制了资源的队列中被调度，则需要总资源大小。</p><p>该值对于三种情况很重要：</p><ol><li>帮派请求大于队列配额</li><li>开始预调度</li><li>预调度时的资源压力</li></ol><p>进一步的细节将在下面的 <a href="#scheduling-in-queues-with-a-quota-set">在设置了配额的队列中进行调度</a> 中给出</p><p>从 shim 传递的信息应该是 AddApplicationRequest 中的一部分。
任务组的建立或成员数量的详细信息不相关。
所有任务组成员请求的总资源使用以下方法计算：</p><p><img alt="请求计算" src="/zh-cn/assets/images/gang_total_ask-5962332571a96d36894af545be00f2b2.png"></p><p>placeholderAsk（占位/资源预留请求）的总计信息作为可选字段添加到 AddApplicationRequest 消息中。
可以由 shim 根据 pod 描述中提供的 CRD 或注释进行计算。</p><p>如果占位请求大于队列上设置的队列配额，则必须拒绝申请。
这种拒绝是基于我们不能以任何方式满足请求的事实。
对于所有其他情况，会接受申请并进行正常的安排。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="使用-fair公平排序策略处理队列">使用 FAIR（公平）排序策略处理队列<a class="hash-link" href="#使用-fair公平排序策略处理队列" title="Direct link to heading">​</a></h3><p>如果将应用程序提交到设置了 FAIR 排序策略的队列，则必须拒绝该应用程序。
应用程序运行所在队列的队列排序必须设置为 <em>FIFO</em> 或 <em>StateAware</em>。</p><p>其他队列策略不能保证一次只处理一个 <em>新的</em> 应用程序。
在 <em>公平</em> 策略的情况下，我们可以同时分配多个 <em>新的</em> 应用程序，从而无法强制实施配额管理。
使用 <em>公平</em> 策略的另一个副作用可能是我们得到多个应用程序但只有部分能保证分配。</p><p>由于核心无法将占位情况放置在任何节点上，因此可以触发自动缩放。
如果队列使用 <em>公平</em> 排序，这可能会导致其他应用程序使用放大的节点而不是预留资源从而再次破坏帮派调度。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="在设置了配额的队列中进行调度">在设置了配额的队列中进行调度<a class="hash-link" href="#在设置了配额的队列中进行调度" title="Direct link to heading">​</a></h2><p>上面已经描述的主要情况是处理大于队列上设置的配额的总占位请求大小。
提交申请时，我们已经可以评估我们无法满足该要求并拒绝该请求。</p><p>在总占位请求确实适合队列的情况下，我们不应该开始调度，直到队列中有足够的可用资源来满足总请求。
然而，这不会停止对队列中其他应用程序的调度。
已在队列中运行的应用程序可能会请求更多资源。
从应用程序的角度来看，它可以请求的资源没有限制。
应用程序上定义的联邦是有保证的资源数量，而不是应用程序可以请求的最大资源数量。</p><p>我们拥有的队列层次结构是很复杂的。
配额可能不是直接在应用程序运行的队列上设置的。
它可以设置在某一个父队列上面。
这种情况可能会变得复杂，我们需要保证记住我们可以实时锁定调度。</p><p>在第一阶段中，我们应该关注这样一种情况，即请求的联邦资源也是应用程序将请求的最大资源数。
当我们查看队列时，我们应该关注具有配额的单个队列级别。</p><p>这两个假设对于没有使用从命名空间到队列的动态映射进行动态分配的 spark 用例是正确的。</p><p>此外，我们假设队列上设置的配额可以完全分配。
如果集群没有足够的资源，集群将扩展，直到为所有队列提供全部配额所需的大小。</p><p>这也可以在某些用例中利用抢占，例如抢占应用程序超过其总的联邦大小的分配。
在某些用例中，也可以利用抢占，比如在应用程序的总帮派规模上抢占分配。</p><p>通过允许指定时间和应用程序来等待占位分配，或开始使用保留资源的时间，可以添加进一步的增强功能。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="调度器逻辑变化">调度器逻辑变化<a class="hash-link" href="#调度器逻辑变化" title="Direct link to heading">​</a></h2><p>调度器逻辑的变化需要考虑周期的两个部分：</p><ul><li>占位请求及其分配。</li><li>替换占位的分配。</li></ul><p>我们的基本假设是所有 pod 都会向核心生成占位 pod 请求。
如果我们不使用应用程序 CRD，这包括触发应用程序创建的 pod。
这个假设是必须的，才能确保调度器核心可以在提交应用程序的两种方式中以相同的方式运行。
占位 Pod 必须在真正的 Pod 之前与核心通信。</p><p>更改占位 AllocationAsks 是第一步。
作为应用程序创建的一部分，AllocationAsks 被添加。
添加 AllocationsAsk 通常会根据调度周期触发应用程序状态的更改。
它将应用程序从 <em>New</em> 状态移动到 <em>Accepted</em> 状态。这与当前设置一致，并且不会更改。</p><p>但是，在 AllocationAsk 设置了 <em>placeholder</em> 标志的情况下，分配不应触发状态更改，应用程序保持在 <em>Accepted</em> 状态。
处理分配请求，直到应用程序没有 pending （挂起）的资源。
作为安全预防措施，应忽略未设置 <em>placeholder</em> 标志的 AllocationAsk。
占位 Pod 的所有结果分配都按照正常步骤向 shim 确认。
这个过程一直持续到没有更多的占位 pod 被分配。</p><p>此时的 shim 应为已缓冲的真实 pod 创建分配任务。
核心不能也不需假设每个应用程序只有一个任务组。
如果 shim 使用了上述选项1，则核心也无法假设它已收到属于任务组的所有分配任务。
这也是为什么我们假设每个 pod 都会向核心创建一个占位请求。</p><p>第二个变化是用真正的 pod 替换了占位 pod。
填充程序创建了一个设置了 <em>任务组名称</em> 但未设置 <em>placeholder</em> 标志的 AllocationAsk。</p><p>这里描述的过程与通用抢占的过程一致。
分配由核心释放，然后由 shim 确认。
对于帮派调度，我们有一个简单的一对一释放关系，在抢占的情况下，我们可以使用具有一对多释放关系的相同流程。</p><p>调度器按如下方式处理 AllocationAsk：</p><ol><li>检查应用程序是否有未释放的分配给具有相同 <em>任务组名称</em> 的占位分配。如果没有找到占位分配，将使用正常的分配周期来分配请求。</li><li>一个占位分配被选择并标记为释放。释放占位分配的请求被传送到 shim。这必须是一个异步过程，因为 shim 释放过程取决于底层的 K8s 响应，这可能不是即时的。
注意：此时核心中没有释放任何分配。</li><li>核心“暂停”处理真正的 AllocationAsk，直到 shim 响应确认已释放占位分配。
注意：释放锁以允许调度继续</li><li>在收到来自 shim 的释放确认后，“暂停的” AllocationAsk 处理会结束。</li><li>AllocationAsk 分配在与使用的占位相同的节点上。
在任何一种情况下，占位分配的删除都将完成。这一切都需要作为对应用程序、队列和节点的一次更新来实现。<ul><li>成功时：创建一个新的分配。</li><li>失败时：尝试在不同的节点上分配，如果失败，AllocationAsk 变得不可调度，并触发扩展。</li></ul></li><li>将分配传达回shim（如果适用，基于步骤 5）</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="应用程序完成">应用程序完成<a class="hash-link" href="#应用程序完成" title="Direct link to heading">​</a></h2><p>应用程序完成一直是一个长期存在的问题。
目前，应用程序在完成时不会转换到 <em>completed</em> 状态。
应用程序的当前状态是 <a href="/zh-cn/docs/next/design/scheduler_object_states">参考文档</a>。
但是，此时应用程序将不会达到 <em>completed</em> 状态，而是停留在 <em>waiting</em> 状态。</p><p>这提供了许多问题，特别是在长时间运行部署中的内存使用和队列清理的情况下。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="定义">定义<a class="hash-link" href="#定义" title="Direct link to heading">​</a></h3><p>由于我们不能依赖在 Kubernetes 上作为 Pod 运行的应用程序来表明它已经完成，因此我们需要定义何时考虑一个应用程序的 <em>完成</em> 。
在这一点上，我们定义了一个应用程序在定义的时间段内处于 <em>等待</em> 状态时，它会变成 <em>完成</em> 。
当没有活动分配（已分配资源 &gt; 0）和挂起分配请求（挂起资源 &gt; 0）时，应用程序进入等待状态。</p><p>向 <em>waiting</em> 状态的转换已经实现。
<em>waiting</em> 状态的超时是一项新的功能。</p><p>资源预留不被视为活动分配。
占位请求被视为待处理的资源请求。
这些情况将在下面的 <a href="#Cleanup">清理</a> 中处理。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="清理">清理<a class="hash-link" href="#清理" title="Direct link to heading">​</a></h3><p>当我们查看帮派调度时，还有一个关于未使用的预留资源、占位请求及其清理的问题。
预留资源可以在有待处理分配请求或活动分配的任何时候转换为实际分配。</p><p>在处理实际分配之前，占位请求将全部转换为占位分配。</p><p>进入 <em>waiting</em> 状态已被处理。
如果将新的分配请求添加到应用程序中，它将转换回 <em>running</em> 状态。
当我们进入了等待状态，将没有待处理的请求或分配的资源。
只有可以分配的预留资源。</p><p>为了进入 <em>waiting</em> 状态，应用程序必须是干净的。
但是，我们不能保证在应用程序运行期间应用程序将使用所有预留资源。
从 <em>waiting</em> 状态转换到 <em>completed</em> 状态根本不需要（占位）分配或请求。
影响转换的第二种情况是并非所有占位请求都被分配，因此应用程序从不请求任何真正的分配。
这两种情况可能会阻止应用程序转换出 <em>accepted</em> 或 <em>waiting</em> 状态。</p><p>因此，核心中的处理需要考虑两种会影响特定状态的转换的情况：</p><ol><li>占位请求挂起（退出 <em>accepted</em> ）</li><li>占位分配（退出 <em>waiting</em> ）</li></ol><p>占位请求挂起：
挂起的占位符是通过超时来处理的。
应用程序只能花费有限的时间等待分配所有预留资源。
这个超时是必需的，因为应用程序的部分占位分配可能会占用集群资源而没有真正使用它们。</p><p>应用程序可能排队等待未知时间，等待占位分配开始。
因此，占位请求的超时不能与应用程序或请求的创建相关联。
超时必须在分配第一个占位请求时开始。</p><p>在所有占位请求都被分配之前，应用程序不能请求真正的分配。
占位请求也由 shim 跟踪，因为它代表一个 pod。
在核心中释放请求需要消息在核心和 shim 之间流动以释放该请求。
但是，在这种情况下，分配预留资源的超时会触发应用程序失败。
当超时被触发并且占位请求挂起时，应用程序将从它所处的状态转换为 <em>killed</em> 。</p><p>本案例的应用状态可以概括为：</p><ul><li>申请状态为 <em>accepted</em></li><li>占位分配的资源大于零，并且小于 <em>AddApplicationRequest</em> 中的 <em>placeholderAsk</em></li><li>待处理资源请求大于零</li></ul><p>进入 <em>killed</em> 状态必须自动将应用程序移出队列。</p><p>状态更改和占位分配释放可以在单个更新响应消息中处理。 该消息将包含以下内容：</p><ul><li><em>UpdatedApplication</em> 用于应用程序的状态变化</li><li>一个或多个 <em>AllocationRelease</em> 消息，每个占位一个，<em>TerminationType</em> 设置为 TIMEOUT</li><li>一条或多条 <em>TerminationType</em> 设置为 TIMEOUT 的 AllocationAskRelease 消息</li></ul><p>shim 首先处理 AllocationAskRelease 消息，然后是 <em>AllocationResponse</em> 消息，最后是 <em>UpdatedApplication</em> 消息。应用程序状态在核心端更改为 <em>killed</em> 状态仅取决于移除所有占位 pod，而不取决于对 <em>UpdatedApplication</em> 消息的响应。</p><p><img alt="占位超时" src="/zh-cn/assets/images/gang_timeout-2e8b67c25538a8f49f7c059f113ac1b0.png"></p><p>占位超时期间 shim 和核心的组合流程：</p><ul><li>核心超时占位分配。 (1)</li><li>删除占位分配被传递到 shim。 (2)</li><li>所有占位分配都由 shim 释放，并传回核心。</li><li>删除占位分配请求被传递给 shim。 (3)</li><li>所有占位分配请求都由 shim 释放，并传回核心。</li><li>在占位分配和请求被释放后，核心将应用程序移动到终止状态，将其从队列中移除 (4)。</li><li>状态更改在核心和 shim 中完成。 (5) </li></ul><p>已分配的占位：
剩余的占位需要由核心释放。
需要通知 shim 将它们移除。这必须在进入 <em>完成</em> 状态时触发。
在核心请求释放占位之后，应用程序的状态转换可以继续。
核心将处理从 shim 返回的占位分配的 <em>AllocationRelease</em> 消息，并将 <em>TerminationType</em> 设置为正常<em>超时</em>，而不会触发状态更改。</p><p>状态更改和占位分配释放可以在单个更新响应消息中处理。
该消息将包含以下内容：</p><ul><li><em>UpdatedApplication</em> 用于应用程序的状态变化</li><li>零个或多个 <em>AllocationRelease</em> 消息，每个占位一个，<em>TerminationType</em> 设置为 <em>超时</em></li></ul><p>shim 首先处理 <em>AllocationResponse</em> 消息，然后是 <em>UpdatedApplication</em> 消息。
应用程序状态在核心端更改为 <em>完成</em> 状态仅依赖于所有占位 pod 的移除，而不依赖于对 <em>UpdatedApplication</em> 消息的响应。</p><p>进入 <em>完成</em> 状态会自动将应用程序移出队列。
这也应该处理我们之前讨论的可能延迟处理来自 shim 的请求的情况，因为我们可以在需要时从 <em>等待</em> 移回 <em>执行中</em> 。
一个 <em>完成</em> 的应用程序也不应该阻止围绕cron讨论的情况，例如每次调用使用相同的应用程序ID提交。
具有相同申请ID的 <em>完成</em> 申请不得阻止提交具有相同ID的新申请。 </p><p><img alt="应用程序清理流程" src="/zh-cn/assets/images/gang_clean_up-c2019679692548acac0667d84feea985.png">
cation to the completed state removing it from the queue (6).</p><ul><li>The state change is finalised in the core and shim. (7)
在清理应用程序期间 shim 和核心的组合流程：</li><li>在 Kubernetes 层发布了一个 pod。 (1)</li><li>shim 将分配释放传递给核心。 (2)</li><li>如果没有挂起或活动的分配，核心会将应用程序转换为等待状态。 (3)</li><li>等待状态超时并触发清理。 (4)</li><li>删除占位符配被传递到 shim。 (5)</li><li>所有占位分配都由 shim 释放，并传回核心。</li><li>释放所有占位后，核心将应用程序移动到完成状态，将其从队列中删除 (6)。</li><li>状态更改在核心和 shim 中完成。 (7) </li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="应用恢复">应用恢复<a class="hash-link" href="#应用恢复" title="Direct link to heading">​</a></h2><p>在应用程序恢复期间，占位 Pod 与节点上的任何其他 Pod 一样被恢复。
这些 pod 由 shim 作为节点现有分配的一部分传递到核心。
现有的分配在核心中没有相应的 <em>分配请求</em>。 核心根据恢复的信息生成 <em>分配请求</em> 。</p><p>对于联邦调度，<em>分配请求</em> 包含 <em>任务组名称</em> 和 <em>占位</em> 标志。
在恢复期间，相同的信息必须是 <em>分配</em> 消息的一部分。
这是因为在两个方向上使用相同的消息，从 RM 到调度器，反之亦然，这意味着我们需要更新消息及其处理。</p><p>如果 <em>分配</em> 消息中缺少信息，则恢复的分配将不会在核心中被正确标记。
恢复的分配将被视为常规分配。
这意味着它作为替换占位的正常分配周期的一部分被跳过。</p><p>逻辑变化只需要现有分配的恢复将接口消息中的字段复制到内核中的分配对象中。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="接口变化">接口变化<a class="hash-link" href="#接口变化" title="Direct link to heading">​</a></h2><p>需要对 shim 和核心之间的通信进行多次更改，以支持所需的帮派信息。</p><p>应用程序必须提供占位请求的总大小，以防止接受永远无法运行的应用程序。</p><p>从 shim 发送到核心以进行分配请求的当前对象在 AllocationAsk 中定义。
由于从调度器核心传回的结果消息不会更改，因此分配不会更改。。但是，对于使用相同分配消息从 shim 到核心的恢复，必须包含与帮派相关的字段。
必须将与帮派相关的字段添加到这两个消息中。</p><p>分配释放请求和响应请求需要支持双向通信，并且需要进行重大更改。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="addapplication">AddApplication<a class="hash-link" href="#addapplication" title="Direct link to heading">​</a></h3><p>The AddApplicationRequest message requires a new field to communicate the total placeholder resource request that will be requested.
The field is used to reject the application if it is impossible to satisfy the request.
It can also be used to stop the core from scheduling any real pods for that application until all placeholder pods are processed.</p><p>In patched message form that would look like:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">message AddApplicationRequest {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // The total amount of resources gang placeholders will request</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Resource placeholderAsk = 7;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="allocationask">AllocationAsk<a class="hash-link" href="#allocationask" title="Direct link to heading">​</a></h3><p>The first part of the change is the base information for the task group.
This will require an additional optional attribute to be added.
The content of this optional attribute is a name, a string, which will be mapped to the name of the task group.
The field can be present on a real allocation and on a placeholder.</p><p>Proposed name for the new field is: <em>taskGroupName</em></p><p>To distinguish normal AllocationAsks and placeholder AllocationAsks a flag must be added.
The flag will never have more than two values and thus maps to a boolean. As the default value for a boolean is <em>false</em> the field should show the fact that it is an AllocationAsk that represents a placeholder as true.</p><p>Proposed name for the field is: <em>placeholder</em></p><p>In patched message form that would look like:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">message AllocationAsk {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // The name of the TaskGroup this ask belongs to</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  string taskGroupName = 10;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // Is this a placeholder ask (true) or a real ask (false), defaults to false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // ignored if the taskGroupName is not set</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bool placeholder = 11;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The last part of the task group information that needs to be communicated is the size of the task group.
This does not require a change in the interface as the current AllocationAsk object can support both possible options.</p><p>Requests can be handled in two ways:</p><ol><li>Each member of the task group is passed to the core as a separate AllocationAsk with a maxAllocations, or the ask repeat, of 1</li><li>The task group is considered one AllocationAsk with a maxAllocations set to the same value as minMember of the task group information.</li></ol><p>With option A the shim will need to generate multiple AllocationAsk objects and pass each to the core for scheduling.
Each AllocationAsk is linked to one pod.
Option B will only generate one AllocationAsk for all placeholder pods.
Option B requires less code and has less overhead on the core side.
However the logic on the shim side might be more complex as the returned allocation needs to be linked to just one pod.</p><p>Proposal is to use option: A</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="allocation">Allocation<a class="hash-link" href="#allocation" title="Direct link to heading">​</a></h3><p>Similar to the change for the <em>AllocationAsk</em> the <em>Allocation</em> requires additional optional attributes to be added.
The new fields distinguish a normal Allocation and placeholder Allocations on recovery.
The same rules apply to these fields as the ones added to the <em>AllocationAsk</em>.</p><p>The content of this optional attribute is a name, a string, which will be mapped to the name of the task group.
The field can be present on a real allocation and on a placeholder.</p><p>Proposed name for the new field is: <em>taskGroupName</em></p><p>The flag will never have more than two values and thus maps to a boolean.
As the default value for a boolean is <em>false</em> the field should show the fact that it is an Allocation that represents a placeholder as true.</p><p>Proposed name for the field is: <em>placeholder</em></p><p>In patched message form that would look like:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Allocation {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // The name of the TaskGroup this allocation belongs to</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  string taskGroupName = 11;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // Is this a placeholder allocation (true) or a real allocation (false), defaults to false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // ignored if the taskGroupName is not set</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bool placeholder = 12;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="allocationrelease-response-and-request">AllocationRelease Response and Request<a class="hash-link" href="#allocationrelease-response-and-request" title="Direct link to heading">​</a></h3><p>The name for the messages are based on the fact that the release is always triggered by the shim.
In case of preemption and or gang scheduling the release is not triggered from the shim but from the core.
That means the message name does not cover the usage. A response message might not have an associated request message.
It could be used to indicate direction but that is in this case confusing.</p><p>When a release is triggered from the core, for preemption or the placeholder allocation, a response is expected from the shim to confirm that the release has been processed.
This response must be distinguished from a request to release the allocation initiated by the shim.
A release initiated by the shim must be followed by a confirmation from the core to the shim that the message is processed.
For releases initiated by the core no such confirmation message can or must be sent.
In the current request message there is no way to indicate that it is a confirmation message.</p><p>To fix the possible confusing naming the proposal is to merge the two messages into one message: <em>AllocationRelease</em>.</p><p>The <em>AllocationReleaseRequest</em> is indirectly part of the <em>UpdateRequest</em> message as it is contained in the <em>AllocationReleasesRequest</em>.
The <em>AllocationReleaseResponse</em> is part of the <em>UpdateResponse</em> message.
The flow-on effect of the rename and merge of the two messages is a change in the two messages that contain them.
The message changes for <em>UpdateResponse</em> and <em>AllocationReleasesRequest</em> are limited to type changes of the existing fields.</p><table><thead><tr><th>Message</th><th>Field ID</th><th>Old type</th><th>New type</th></tr></thead><tbody><tr><td>UpdateResponse</td><td>3</td><td>AllocationReleaseResponse</td><td>AllocationRelease</td></tr><tr><td>AllocationReleasesRequest</td><td>1</td><td>AllocationReleaseRequest</td><td>AllocationRelease</td></tr></tbody></table><p>In patched message form that would look like:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">message UpdateResponse {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // Released allocation(s), allocations can be released by either the RM or scheduler.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // The TerminationType defines which side needs to act and process the message. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  repeated AllocationRelease releasedAllocations = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">message AllocationReleasesRequest {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // Released allocation(s), allocations can be released by either the RM or scheduler.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // The TerminationType defines which side needs to act and process the message. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  repeated AllocationRelease releasedAllocations = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The merged message <em>AllocationRelease</em> will consist of:</p><table><thead><tr><th>Field name</th><th>Content type</th><th>Required</th></tr></thead><tbody><tr><td>partitionName</td><td>string</td><td>yes</td></tr><tr><td>applicationID</td><td>string</td><td>no</td></tr><tr><td>UUID</td><td>string</td><td>no</td></tr><tr><td>terminationType</td><td><em>TerminationType</em></td><td>yes</td></tr><tr><td>message</td><td>string</td><td>no</td></tr></tbody></table><p>Confirmation behaviour of the action should be triggered on the type of termination received.
The core will confirm the release to the shim of all types that originate in the shim and vice versa.</p><p>A confirmation or response uses the same <em>TerminationType</em> as was set in the original message.
An example of this is a pod that is removed from K8s will trigger an <em>AllocationRelease _message to be sent from the shim to the core with the TerminationType STOPPED_BY_RM. The core processes the request removing the allocation from the internal structures, and when all processing is done it responds to the shim with a message using the same _TerminationType</em>.
The shim can ignore that or make follow up changes if needed.</p><p>A similar process happens for a release that originates in the core.
Example of the core sending an <em>AllocationRelease</em> message to the shim using the <em>TerminationType</em> PREEMPTED_BY_SCHEDULER.
The shim handles that by releasing the pod identified and responds to the core that it has released the pod.
On receiving the confirmation that the pod has been released the core can progress with the allocation and preemption processing.</p><p>In patched message form that would look like:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">message AllocationRelease {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  enum TerminationType {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    STOPPED_BY_RM = 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TIMEOUT = 1; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    PREEMPTED_BY_SCHEDULER = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    PLACEHOLDER_REPLACED = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // The name of the partition the allocation belongs to</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  string partitionName = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // The application the allocation belongs to</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  string applicationID = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // The UUID of the allocation to release, if not set all allocations are released for</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // the applicationID</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  string UUID = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // The termination type as described above </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  TerminationType terminationType = 4;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // human-readable message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  string message = 5;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="terminationtype">TerminationType<a class="hash-link" href="#terminationtype" title="Direct link to heading">​</a></h3><p>The currently defined <em>TerminationType</em> values and specification of the side that generates (Sender), and the side that actions and confirms processing (Receiver):</p><table><thead><tr><th>Value</th><th>Sender</th><th>Receiver</th></tr></thead><tbody><tr><td>STOPPED_BY_RM</td><td>shim</td><td>core</td></tr><tr><td>TIMEOUT *</td><td>core</td><td>shim</td></tr><tr><td>PREEMPTED_BY_SCHEDULER *</td><td>core</td><td>shim</td></tr></tbody></table><ul><li>currently not handled by the shim, core or both</li></ul><p>When the placeholder allocation gets released the <em>AllocationReleaseResponse</em> is used to communicate the release back from the core to the shim.
The response contains an enumeration called <em>TerminationType</em>, and a human-readable message.
For tracking and tracing purposes we should add a new <em>TerminationType</em> specifically for the placeholder replacement. The shim must take action based on the type and confirm the allocation release to the core.</p><p>It should provide enough detail so we do not have to re-use an already existing type, or the human-readable message.
The human-readable format can still be used to provide further detail on which new allocation replaced the placeholder.</p><p>Proposal is to add: <em>PLACEHOLDER_REPLACED</em></p><table><thead><tr><th>Value</th><th>Sender</th><th>Receiver</th></tr></thead><tbody><tr><td>PLACEHOLDER_REPLACED</td><td>shim</td><td>core</td></tr></tbody></table><p>As part of the Scheduler Interface cleanup (<a href="https://issues.apache.org/jira/browse/YUNIKORN-486" target="_blank" rel="noopener noreferrer">YUNIKORN-486</a>) the <em>TerminationType</em> should be extracted from the <em>AllocationRelease</em> and <em>AllocationaskRelease</em> message.
It is an enumeration that can be shared between multiple objects.
<a href="https://issues.apache.org/jira/browse/YUNIKORN-547" target="_blank" rel="noopener noreferrer">YUNIKORN-547</a> has been logged to handle this as it has an impact on the code outside of the scope of gang scheduling.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="allocationaskrelease-response-and-request">AllocationAskRelease Response and Request<a class="hash-link" href="#allocationaskrelease-response-and-request" title="Direct link to heading">​</a></h3><p>The allocation ask release right now can only be triggered by the shim.
In order for the core to perform the cleanup when the placeholder allocation times out, we need to make this a bidirectional message.
Similarly to the Allocation we would rename the <em>AllocationAskReleaseRequest</em> to <em>AllocationAskRelease</em>, so we can use this message in both directions:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">message AllocationReleasesRequest {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // Released allocationask(s), allocationasks can be released by either the RM or</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // scheduler. The TerminationType defines which side needs to act and process the</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // message. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  repeated AllocationAskRelease allocationAsksToRelease = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Similar processing logic based on the <em>TerminationType</em> which is used for allocations should be used for ask releases.
In patched message form that would look like:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">message AllocationAskRelease {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  enum TerminationType {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    STOPPED_BY_RM = 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TIMEOUT = 1; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    PREEMPTED_BY_SCHEDULER = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    PLACEHOLDER_REPLACED = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // The termination type as described above </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  TerminationType terminationType = 4;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Confirmation behaviour of the action should be triggered on the type of termination received.
The core will confirm the release to the shim of all types that originate in the shim and vice versa.</p><p>A confirmation or response uses the same <em>TerminationType</em> as was set in the original message.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="scheduler-storage-object-changes">Scheduler storage object changes<a class="hash-link" href="#scheduler-storage-object-changes" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="allocationask-1">AllocationAsk<a class="hash-link" href="#allocationask-1" title="Direct link to heading">​</a></h3><p>In line with the changes for the communication the objects in the scheduler also need to be modified to persist some of the detail communicated.
The AllocationAsk that is used in the communication has an equivalent object inside the scheduler with the same name.
This object needs to be able to store the new fields proposed above.</p><p>Proposed new fields: <em>taskGroupName</em> and <em>placeholder</em>.</p><p>In the current interface specification a field called <em>executionTimeoutMilliSeconds</em> is defined.
This is currently not mapped to the object inside the scheduler and should be added.
Time or Duration are stored as native go objects and do not include a size specifier.</p><p>Proposed new field: <em>execTimeout</em></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="allocation-1">Allocation<a class="hash-link" href="#allocation-1" title="Direct link to heading">​</a></h3><p>After the allocation is made an Allocation object is created in the core to track the real allocation. This Allocation object is directly linked to the application and should show that the allocation is a placeholder and for which task group. This detail is needed to also enable the correct display of the resources used in the web UI.</p><p>The propagation of the placeholder information could be achieved indirectly as the allocation object references an AllocationAsk. This would require a lookup of the AllocationAsk to assess the type of allocation. We could also opt to propagate the data into the Allocation object itself. This would remove the lookup and allow us to directly filter allocations based on the type and or task group information.</p><p>From a scheduling and scheduler logic perspective the indirect reference is not really desirable due to the overhead of the lookups required. This means that the same fields added in the AllocationAsk are also added to the Allocation object.</p><p>Proposed new fields: <em>taskGroupName</em> and <em>placeholder</em>.</p><p>To support the release of the allocation being triggered from the core tracking of the release action is required. The release is not final until the shim has confirmed that release. However during that time period the allocation may not be released again.</p><p>Proposed new field: <em>released</em></p><p>At the point that we replace the placeholder with a real allocation we need to release an existing placeholder.
The Allocation object allows us to specify a list of Allocations to release.
This field was added earlier to support preemption.
This same field will be reused for the placeholder release.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="application">Application<a class="hash-link" href="#application" title="Direct link to heading">​</a></h3><p>The AddApplicationRequest has a new field added that needs to be persisted in the object inside the scheduler.</p><p>Proposed new field: <em>placeholderAsk</em></p><p>In the current interface specification a field called <em>executionTimeoutMilliSeconds</em> is defined. This is currently not mapped to the object inside the scheduler and should be added. Time or Duration are stored as native go objects and do not include a size specifier.</p><p>Proposed new field: <em>execTimeout</em></p><p>The application object should be able to track the placeholder allocations separately from the real allocations. The split of the allocation types on the application will allow us to show the proper state in the web UI.</p><p>Proposed new field: <em>allocatedPlaceholder</em></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="queue--node">Queue &amp; Node<a class="hash-link" href="#queue--node" title="Direct link to heading">​</a></h3><p>No changes at this point.
The placeholder allocations should be counted as “real” allocations on the Queue and Node.
By counting the placeholder as normal the quota for the queue is enforced as expected.
The Node object needs to also show normal usage to prevent interactions with the autoscaler.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh-cn/docs/next/design/scheduler_object_states"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Scheduler Object States</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh-cn/docs/next/performance/evaluate_perf_function_with_kubemark"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Evaluate YuniKorn Performance with Kubemark</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#文档目标" class="table-of-contents__link toc-highlight">文档目标</a></li><li><a href="#排除的设计点" class="table-of-contents__link toc-highlight">排除的设计点</a></li><li><a href="#通用流程" class="table-of-contents__link toc-highlight">通用流程</a></li><li><a href="#应用提交处理" class="table-of-contents__link toc-highlight">应用提交处理</a><ul><li><a href="#预留资源总大小" class="table-of-contents__link toc-highlight">预留资源总大小</a></li><li><a href="#使用-fair公平排序策略处理队列" class="table-of-contents__link toc-highlight">使用 FAIR（公平）排序策略处理队列</a></li></ul></li><li><a href="#在设置了配额的队列中进行调度" class="table-of-contents__link toc-highlight">在设置了配额的队列中进行调度</a></li><li><a href="#调度器逻辑变化" class="table-of-contents__link toc-highlight">调度器逻辑变化</a></li><li><a href="#应用程序完成" class="table-of-contents__link toc-highlight">应用程序完成</a><ul><li><a href="#定义" class="table-of-contents__link toc-highlight">定义</a></li><li><a href="#清理" class="table-of-contents__link toc-highlight">清理</a></li></ul></li><li><a href="#应用恢复" class="table-of-contents__link toc-highlight">应用恢复</a></li><li><a href="#接口变化" class="table-of-contents__link toc-highlight">接口变化</a><ul><li><a href="#addapplication" class="table-of-contents__link toc-highlight">AddApplication</a></li><li><a href="#allocationask" class="table-of-contents__link toc-highlight">AllocationAsk</a></li><li><a href="#allocation" class="table-of-contents__link toc-highlight">Allocation</a></li><li><a href="#allocationrelease-response-and-request" class="table-of-contents__link toc-highlight">AllocationRelease Response and Request</a></li><li><a href="#terminationtype" class="table-of-contents__link toc-highlight">TerminationType</a></li><li><a href="#allocationaskrelease-response-and-request" class="table-of-contents__link toc-highlight">AllocationAskRelease Response and Request</a></li></ul></li><li><a href="#scheduler-storage-object-changes" class="table-of-contents__link toc-highlight">Scheduler storage object changes</a><ul><li><a href="#allocationask-1" class="table-of-contents__link toc-highlight">AllocationAsk</a></li><li><a href="#allocation-1" class="table-of-contents__link toc-highlight">Allocation</a></li><li><a href="#application" class="table-of-contents__link toc-highlight">Application</a></li><li><a href="#queue--node" class="table-of-contents__link toc-highlight">Queue &amp; Node</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">博客</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.cloudera.com/yunikorn-a-universal-resources-scheduler/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>What&#x27;s YuniKorn?<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://blog.cloudera.com/apache-yunikorn-incubating-0-8-release-whats-new-and-upcoming/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>What&#x27;s new in YuniKorn 0.8.0?<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>scheduler-core<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-k8shim" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>kubernetes-shim<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>scheduler-interface<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-web" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>scheduler-web<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh-cn/community/get_involved">参与</a></li><li class="footer__item"><a href="https://people.apache.org/phonebook.html?podling=yunikorn" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>名册<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/YUNIKORN/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_SRtH"><img src="https://incubator.apache.org/images/incubator_feather_egg_logo.png" alt="Apache Incubator Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="https://incubator.apache.org/images/incubator_feather_egg_logo.png" alt="Apache Incubator Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">
<div style="font-size: 70%">
Copyright © 2020-2022 <a href="https://www.apache.org/">The Apache Software Foundation</a>. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. <br>
<div style="padding:20px; margin: 10px; color: #4d4d4d;">
<p>Apache YuniKorn is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p>

<p>The Apache Software Foundation Apache YuniKorn, YuniKorn, Apache, the Apache feather, and the Apache YuniKorn project logo are either registered trademarks or trademarks of the Apache Software Foundation.  Apache YuniKorn is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the name of Apache TLP sponsor.</p>
</div>
</div></div></div></div></footer></div>
<script src="/zh-cn/assets/js/runtime~main.02e225f2.js"></script>
<script src="/zh-cn/assets/js/main.99e2b574.js"></script>
</body>
</html>